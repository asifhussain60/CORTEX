# CORTEX Admin Structure Migration Plan
# Comprehensive phased migration for admin feature reorganization
# Generated: 2025-11-18
# Author: Asif Hussain
# Status: APPROVED - Ready for execution

version: "1.0"
plan_type: "infrastructure_migration"
estimated_total_duration: "13-15 hours"
risk_level: "medium"
phases: 4

metadata:
  created: "2025-11-18"
  approved_by: "asifhussain60"
  conversation_reference: "CC03-DocOrg"
  architecture_analysis: "Complete holistic review performed"
  files_to_migrate: 70
  directories_to_create: 15
  path_references_to_update: "50+"

objectives:
  primary: "Centralize all admin features under cortex-brain/admin/ structure"
  secondary:
    - "Improve discoverability of admin tools and scripts"
    - "Simplify publish filtering (exclude admin from production packages)"
    - "Maintain clean separation: admin vs user-facing brain"
    - "Preserve git history through git mv operations"
    - "Validate system health after each phase"

success_criteria:
  - "All 70 admin files relocated to admin/ hierarchy"
  - "Zero broken path references (all scripts execute)"
  - "834 existing tests pass without modification"
  - "Publish script excludes admin/ folder from user packages"
  - "Documentation updated (READMEs in all admin subfolders)"
  - "Migration rollback plan documented"

exclusion_from_production:
  description: "Admin folder MUST be excluded from CORTEX production publish"
  publish_config_update:
    file: "cortex-brain/publish-config.yaml"
    exclude_patterns:
      - "cortex-brain/admin/**"
      - "!cortex-brain/admin/README.md"  # Include top-level README only
  rationale: |
    Admin features are for CORTEX maintainers, not end users:
    - Documentation generation (EPM system)
    - Publishing/deployment scripts
    - Optimization tools (token analysis)
    - Validation scripts (system health)
    - Metrics/reports (internal telemetry)
    - Maintenance utilities (cleanup, migration)
    
    Users should NOT receive:
    - Internal metrics/reports
    - Admin operation logs
    - Deployment scripts
    - Optimization tools
    - Maintenance scripts

rollback_strategy:
  description: "Rollback plan if migration causes issues"
  steps:
    - "Git revert migration commit (preserves history)"
    - "Re-run test suite to verify rollback successful"
    - "Document issues encountered for future analysis"
  backup:
    - "Git branch created before migration: admin-migration-backup"
    - "Full cortex-brain/ snapshot: admin-migration-backup.tar.gz"

# ============================================================================
# PHASE 1: Documentation Outputs & Reports (LOW RISK)
# ============================================================================

phase_1:
  name: "Documentation & Reports Migration"
  duration: "3-4 hours"
  risk_level: "low"
  dependencies: []
  rationale: |
    Start with lowest-risk files that have few/no path references:
    - Documentation generation outputs (static files)
    - System health reports (JSON/YAML data)
    - Admin operation logs (historical records)
    - Export files (backups, brain exports)
  
  target_structure:
    create_directories:
      - "cortex-brain/admin/"
      - "cortex-brain/admin/documentation/"
      - "cortex-brain/admin/documentation/generated/"
      - "cortex-brain/admin/documentation/templates/"
      - "cortex-brain/admin/reports/"
      - "cortex-brain/admin/reports/health/"
      - "cortex-brain/admin/reports/optimization/"
      - "cortex-brain/admin/logs/"
      - "cortex-brain/admin/logs/operations/"
      - "cortex-brain/admin/logs/cleanup/"
      - "cortex-brain/admin/exports/"
  
  file_migrations:
    documentation_outputs:
      source: "cortex-brain/documents/"
      target: "cortex-brain/admin/documentation/generated/"
      files:
        - "CORTEX-DESIGN-STATUS.md"
        - "CORTEX-OPERATIONS.md"
        - "OPERATIONS-REFERENCE.md"
        - "MODULE-INDEX.md"
        - "AGENT-REFERENCE.md"
      command: |
        git mv cortex-brain/documents/CORTEX-DESIGN-STATUS.md cortex-brain/admin/documentation/generated/
        git mv cortex-brain/documents/CORTEX-OPERATIONS.md cortex-brain/admin/documentation/generated/
        git mv cortex-brain/documents/CORTEX-OPERATIONS.md cortex-brain/admin/documentation/generated/
        git mv cortex-brain/documents/MODULE-INDEX.md cortex-brain/admin/documentation/generated/
        git mv cortex-brain/documents/AGENT-REFERENCE.md cortex-brain/admin/documentation/generated/
    
    health_reports:
      source: "cortex-brain/health-reports/"
      target: "cortex-brain/admin/reports/health/"
      files: ["*.json", "*.yaml"]
      command: |
        git mv cortex-brain/health-reports/* cortex-brain/admin/reports/health/
    
    optimization_reports:
      source: "cortex-brain/"
      target: "cortex-brain/admin/reports/optimization/"
      files:
        - "CLEANUP-DRY-RUN-REPORT.json"
        - "TOKEN-OPTIMIZATION-REPORT.json"
        - "YAML-VALIDATION-REPORT.json"
      command: |
        git mv cortex-brain/CLEANUP-DRY-RUN-REPORT.json cortex-brain/admin/reports/optimization/
        # Move other optimization reports if exist
    
    operation_logs:
      source: "cortex-brain/cleanup-logs/"
      target: "cortex-brain/admin/logs/operations/"
      files: ["*.json", "*.log"]
      command: |
        git mv cortex-brain/cleanup-logs/* cortex-brain/admin/logs/operations/
    
    cleanup_logs:
      source: "cortex-brain/sweeper-logs/"
      target: "cortex-brain/admin/logs/cleanup/"
      files: ["*.json", "*.log"]
      command: |
        git mv cortex-brain/sweeper-logs/* cortex-brain/admin/logs/cleanup/
    
    exports:
      source: "cortex-brain/exports/"
      target: "cortex-brain/admin/exports/"
      files: ["brain-export-*.yaml", "*.zip", "*.tar.gz"]
      command: |
        git mv cortex-brain/exports cortex-brain/admin/exports
  
  path_updates_required:
    count: 0
    rationale: "These are output files with no incoming references"
  
  validation_steps:
    - step: 1
      action: "Run test suite"
      command: "pytest tests/ -v"
      expected: "834 tests passing (no change from baseline)"
    
    - step: 2
      action: "Verify directory structure"
      command: "ls -R cortex-brain/admin/"
      expected: "All subdirectories created, files present"
    
    - step: 3
      action: "Check git history preservation"
      command: "git log --follow cortex-brain/admin/documentation/generated/CORTEX-DESIGN-STATUS.md"
      expected: "Full commit history visible"
    
    - step: 4
      action: "Update .gitignore if needed"
      command: "Check for admin-specific ignore patterns"
      expected: "Logs folder in .gitignore"
  
  documentation_updates:
    - file: "cortex-brain/admin/README.md"
      content: |
        # CORTEX Admin Features
        
        Internal administration tools, scripts, and reports for CORTEX maintainers.
        
        **NOT included in production publish** - these are for framework development only.
        
        ## Structure
        - `documentation/` - Generated documentation outputs (EPM system)
        - `reports/` - Health reports, optimization analysis
        - `logs/` - Operation logs, cleanup logs
        - `exports/` - Brain exports, backups
    
    - file: "cortex-brain/admin/documentation/README.md"
      content: "Documentation generation outputs from EPM (Execution Plan Module) system"
    
    - file: "cortex-brain/admin/reports/README.md"
      content: "System health reports, optimization analysis, metrics"
    
    - file: "cortex-brain/admin/logs/README.md"
      content: "Operation logs from admin scripts (cleanup, optimization, validation)"
    
    - file: "cortex-brain/admin/exports/README.md"
      content: "Brain exports, migration backups, data snapshots"
  
  rollback_procedure:
    if_issues_encountered:
      - "git revert <migration-commit>"
      - "pytest tests/ -v  # Verify rollback successful"
      - "Document issue in phase_1_rollback_notes.md"
  
  completion_criteria:
    - "✓ All Phase 1 directories created"
    - "✓ All files moved with git mv (history preserved)"
    - "✓ Test suite passes (834/834)"
    - "✓ READMEs created for all admin subfolders"
    - "✓ .gitignore updated for logs"

# ============================================================================
# PHASE 2: Admin Scripts Migration (MEDIUM RISK)
# ============================================================================

phase_2:
  name: "Admin Scripts & Utilities"
  duration: "4-5 hours"
  risk_level: "medium"
  dependencies: ["phase_1_complete"]
  rationale: |
    Move admin-specific scripts from scripts/ folder to admin/scripts/.
    Medium risk due to path references in:
    - VS Code tasks.json
    - Documentation
    - Other scripts
    - CI/CD pipelines (if any)
  
  target_structure:
    create_directories:
      - "cortex-brain/admin/scripts/"
      - "cortex-brain/admin/scripts/documentation/"
      - "cortex-brain/admin/scripts/publishing/"
      - "cortex-brain/admin/scripts/optimization/"
      - "cortex-brain/admin/scripts/validation/"
      - "cortex-brain/admin/scripts/maintenance/"
      - "cortex-brain/admin/scripts/migration/"
      - "cortex-brain/admin/scripts/utilities/"
  
  file_migrations:
    documentation_scripts:
      source: "scripts/"
      target: "cortex-brain/admin/scripts/documentation/"
      files:
        - "generate_cortex_operations_md.py"
        - "generate_operations_reference.py"
        - "build_module_index.py"
        - "create_agent_reference.py"
        - "doc_refresh_orchestrator.py"
      rationale: "EPM documentation generation system scripts"
      command: |
        git mv scripts/generate_cortex_operations_md.py cortex-brain/admin/scripts/documentation/
        git mv scripts/generate_operations_reference.py cortex-brain/admin/scripts/documentation/
        git mv scripts/build_module_index.py cortex-brain/admin/scripts/documentation/
        git mv scripts/create_agent_reference.py cortex-brain/admin/scripts/documentation/
        git mv scripts/doc_refresh_orchestrator.py cortex-brain/admin/scripts/documentation/
    
    publishing_scripts:
      source: "scripts/"
      target: "cortex-brain/admin/scripts/publishing/"
      files:
        - "publish_cortex.py"
        - "package_cortex.py"
        - "verify_publish_package.py"
      rationale: "Production packaging and deployment"
      command: |
        git mv scripts/publish_cortex.py cortex-brain/admin/scripts/publishing/
        git mv scripts/package_cortex.py cortex-brain/admin/scripts/publishing/
        git mv scripts/verify_publish_package.py cortex-brain/admin/scripts/publishing/
    
    optimization_scripts:
      source: "scripts/"
      target: "cortex-brain/admin/scripts/optimization/"
      files:
        - "optimize_cortex.py"
        - "token_counter.py"
        - "yaml_validator.py"
        - "plugin_health_checker.py"
        - "database_optimizer.py"
      rationale: "System optimization and analysis tools"
      command: |
        git mv scripts/optimize_cortex.py cortex-brain/admin/scripts/optimization/
        git mv scripts/token_counter.py cortex-brain/admin/scripts/optimization/
        git mv scripts/yaml_validator.py cortex-brain/admin/scripts/optimization/
        git mv scripts/plugin_health_checker.py cortex-brain/admin/scripts/optimization/
        git mv scripts/database_optimizer.py cortex-brain/admin/scripts/optimization/
    
    validation_scripts:
      source: "scripts/"
      target: "cortex-brain/admin/scripts/validation/"
      files:
        - "validate_tier0_governance.py"
        - "verify_brain_health.py"
        - "check_protection_layers.py"
        - "test_runner.py"
      rationale: "System health and governance validation"
      command: |
        git mv scripts/validate_tier0_governance.py cortex-brain/admin/scripts/validation/
        git mv scripts/verify_brain_health.py cortex-brain/admin/scripts/validation/
        git mv scripts/check_protection_layers.py cortex-brain/admin/scripts/validation/
        git mv scripts/test_runner.py cortex-brain/admin/scripts/validation/
    
    maintenance_scripts:
      source: "scripts/"
      target: "cortex-brain/admin/scripts/maintenance/"
      files:
        - "cleanup_orchestrator.py"
        - "brain_sweeper.py"
        - "archive_manager.py"
        - "log_rotator.py"
      rationale: "System maintenance and cleanup utilities"
      command: |
        git mv scripts/cleanup_orchestrator.py cortex-brain/admin/scripts/maintenance/
        git mv scripts/brain_sweeper.py cortex-brain/admin/scripts/maintenance/
        git mv scripts/archive_manager.py cortex-brain/admin/scripts/maintenance/
        git mv scripts/log_rotator.py cortex-brain/admin/scripts/maintenance/
    
    migration_scripts:
      source: "scripts/"
      target: "cortex-brain/admin/scripts/migration/"
      files:
        - "brain_transfer_cli.py"
        - "migrate_brain_db.py"
        - "conversation_importer.py"
      rationale: "Database migration and data transfer tools"
      command: |
        git mv scripts/brain_transfer_cli.py cortex-brain/admin/scripts/migration/
        git mv scripts/migrate_brain_db.py cortex-brain/admin/scripts/migration/
        git mv scripts/conversation_importer.py cortex-brain/admin/scripts/migration/
    
    utility_scripts:
      source: "scripts/"
      target: "cortex-brain/admin/scripts/utilities/"
      files:
        - "brain_query.py"
        - "pattern_analyzer.py"
        - "git_analysis.py"
      rationale: "General-purpose admin utilities"
      command: |
        git mv scripts/brain_query.py cortex-brain/admin/scripts/utilities/
        git mv scripts/pattern_analyzer.py cortex-brain/admin/scripts/utilities/
        git mv scripts/git_analysis.py cortex-brain/admin/scripts/utilities/
  
  path_updates_required:
    count: 15
    locations:
      - file: ".vscode/tasks.json"
        updates:
          - "Update publish task: scripts/publish_cortex.py → cortex-brain/admin/scripts/publishing/publish_cortex.py"
          - "Update optimize task: scripts/optimize_cortex.py → cortex-brain/admin/scripts/optimization/optimize_cortex.py"
          - "Update cleanup task: scripts/cleanup_orchestrator.py → cortex-brain/admin/scripts/maintenance/cleanup_orchestrator.py"
      
      - file: "cortex-operations.yaml"
        updates:
          - "publish_cortex operation: Update executor path"
          - "optimize_cortex operation: Update executor path"
          - "cleanup operation: Update executor path"
      
      - file: "docs/operations/publish-cortex.md"
        updates:
          - "Example commands: Update script paths"
      
      - file: "docs/operations/optimize-cortex.md"
        updates:
          - "Example commands: Update script paths"
      
      - file: "README.md"
        updates:
          - "Admin scripts section: Update paths"
      
      - file: "cortex-brain/admin/scripts/*/README.md"
        action: "Create README for each script category"
  
  validation_steps:
    - step: 1
      action: "Verify all git mv operations successful"
      command: "git status"
      expected: "Moved files in staging area"
    
    - step: 2
      action: "Test admin script imports"
      command: "python -c 'from cortex_brain.admin.scripts.publishing import publish_cortex'"
      expected: "No import errors"
    
    - step: 3
      action: "Run test suite"
      command: "pytest tests/ -v"
      expected: "834 tests passing"
    
    - step: 4
      action: "Test VS Code tasks"
      command: "code --list-tasks"
      expected: "All tasks load without errors"
    
    - step: 5
      action: "Execute one admin script"
      command: "python cortex-brain/admin/scripts/validation/verify_brain_health.py --dry-run"
      expected: "Script executes successfully"
  
  documentation_updates:
    - file: "cortex-brain/admin/scripts/README.md"
      content: |
        # CORTEX Admin Scripts
        
        Administration utilities organized by function:
        
        - `documentation/` - EPM doc generation (5 scripts)
        - `publishing/` - Production packaging (3 scripts)
        - `optimization/` - Token/YAML/plugin analysis (5 scripts)
        - `validation/` - Health checks, governance (4 scripts)
        - `maintenance/` - Cleanup, archival (4 scripts)
        - `migration/` - Data transfer, DB migration (3 scripts)
        - `utilities/` - General tools (3 scripts)
        
        Total: 27 admin scripts centralized here.
    
    - file: "cortex-brain/admin/scripts/documentation/README.md"
      content: "EPM (Execution Plan Module) documentation generation system"
    
    - file: "cortex-brain/admin/scripts/publishing/README.md"
      content: "Production packaging and deployment scripts"
    
    - file: "cortex-brain/admin/scripts/optimization/README.md"
      content: "System optimization: token analysis, YAML validation, plugin health, database optimization"
    
    - file: "cortex-brain/admin/scripts/validation/README.md"
      content: "Governance validation, brain health checks, protection layer verification"
    
    - file: "cortex-brain/admin/scripts/maintenance/README.md"
      content: "System cleanup, archive management, log rotation"
    
    - file: "cortex-brain/admin/scripts/migration/README.md"
      content: "Database migration, brain transfer, conversation import tools"
    
    - file: "cortex-brain/admin/scripts/utilities/README.md"
      content: "General-purpose admin utilities: brain query, pattern analysis, git analysis"
  
  rollback_procedure:
    if_issues_encountered:
      - "git reset --hard HEAD~1  # Undo Phase 2 commit"
      - "pytest tests/ -v  # Verify rollback"
      - "Check tasks.json still works with old paths"
      - "Document issue in phase_2_rollback_notes.md"
  
  completion_criteria:
    - "✓ All 27 admin scripts moved to admin/scripts/ hierarchy"
    - "✓ Path references updated in tasks.json, operations, docs"
    - "✓ Test suite passes (834/834)"
    - "✓ READMEs created for all script categories"
    - "✓ At least one script tested successfully"

# ============================================================================
# PHASE 3: Remaining Scripts & Comprehensive Path Updates (HIGH RISK)
# ============================================================================

phase_3:
  name: "Remaining Scripts & Path Refactoring"
  duration: "4-5 hours"
  risk_level: "high"
  dependencies: ["phase_2_complete"]
  rationale: |
    HIGH RISK phase due to:
    - Moving user-facing setup/capture scripts (may affect user workflows)
    - Comprehensive path updates across 50+ files
    - Potential cascading reference issues
    - PowerShell scripts with hardcoded paths
  
  target_structure:
    create_directories:
      - "cortex-brain/admin/operations/"
      - "cortex-brain/admin/operations/executors/"
      - "cortex-brain/admin/operations/orchestrators/"
      - "cortex-brain/admin/metrics/"
      - "cortex-brain/admin/simulations/"
      - "cortex-brain/admin/archives/"
  
  file_migrations:
    operation_executors:
      source: "scripts/"
      target: "cortex-brain/admin/operations/executors/"
      files:
        - "execute_operation.py"
        - "operation_dispatcher.py"
        - "module_loader.py"
      rationale: "Operation execution infrastructure"
      command: |
        git mv scripts/execute_operation.py cortex-brain/admin/operations/executors/
        git mv scripts/operation_dispatcher.py cortex-brain/admin/operations/executors/
        git mv scripts/module_loader.py cortex-brain/admin/operations/executors/
    
    orchestrators:
      source: "scripts/"
      target: "cortex-brain/admin/operations/orchestrators/"
      files:
        - "design_sync_orchestrator.py"
        - "onboarding_orchestrator.py"
      rationale: "High-level workflow orchestrators"
      command: |
        git mv scripts/design_sync_orchestrator.py cortex-brain/admin/operations/orchestrators/
        git mv scripts/onboarding_orchestrator.py cortex-brain/admin/operations/orchestrators/
    
    metrics_collectors:
      source: "cortex-brain/metrics/"
      target: "cortex-brain/admin/metrics/"
      files: ["*.json", "*.yaml"]
      rationale: "Internal metrics (not user-facing)"
      command: |
        git mv cortex-brain/metrics cortex-brain/admin/metrics
    
    simulations:
      source: "cortex-brain/simulations/"
      target: "cortex-brain/admin/simulations/"
      files: ["*.json", "*.yaml"]
      rationale: "Testing simulations (development only)"
      command: |
        git mv cortex-brain/simulations cortex-brain/admin/simulations
    
    archives:
      source: "cortex-brain/archives/"
      target: "cortex-brain/admin/archives/"
      files: ["*.tar.gz", "*.zip"]
      rationale: "Historical backups (admin only)"
      command: |
        git mv cortex-brain/archives cortex-brain/admin/archives
    
    setup_scripts_decision:
      keep_in_place:
        - "scripts/cortex_setup.py"
        - "scripts/cortex-capture.ps1"
        - "scripts/cortex_cli.py"
      rationale: |
        These are USER-FACING scripts that users run directly:
        - cortex_setup.py: First-time setup (documented in setup-guide.md)
        - cortex-capture.ps1: Conversation capture (user workflow)
        - cortex_cli.py: Command-line interface (user commands)
        
        KEEP in scripts/ folder for user accessibility.
        Do NOT move to admin/ (would break documented workflows).
  
  comprehensive_path_updates:
    count: 52
    high_risk_files:
      - file: "src/operations/execute_operation_impl.py"
        updates:
          - "Import paths: from scripts.execute_operation → from cortex_brain.admin.operations.executors.execute_operation"
        risk: "HIGH - Core operation execution"
      
      - file: "src/operations/operation_router.py"
        updates:
          - "Module loader path: scripts/module_loader.py → cortex_brain/admin/operations/executors/module_loader.py"
        risk: "HIGH - Operation routing"
      
      - file: "cortex-operations.yaml"
        updates:
          - "All executor paths (13 operations)"
          - "publish_cortex: scripts/publish_cortex.py → cortex-brain/admin/scripts/publishing/publish_cortex.py"
          - "optimize_cortex: scripts/optimize_cortex.py → cortex-brain/admin/scripts/optimization/optimize_cortex.py"
          - "design_sync: scripts/design_sync_orchestrator.py → cortex-brain/admin/operations/orchestrators/design_sync_orchestrator.py"
        risk: "HIGH - All operations depend on this"
      
      - file: ".vscode/tasks.json"
        updates:
          - "Publish task: Update script path"
          - "Optimize task: Update script path"
          - "Cleanup task: Update script path"
          - "Validate task: Update script path"
        risk: "MEDIUM - User IDE workflows"
      
      - file: "cortex-brain/module-definitions.yaml"
        updates:
          - "cleanup_orchestrator: Update executor path"
          - "validate_tier0_governance: Update executor path"
          - "doc_refresh_orchestrator: Update executor path"
        risk: "MEDIUM - Module execution"
      
      - file: "tests/operations/test_execute_operation.py"
        updates:
          - "Import paths for operation executors"
        risk: "HIGH - Test suite must pass"
      
      - file: "tests/integration/test_operation_flow.py"
        updates:
          - "Mock paths for admin scripts"
        risk: "HIGH - Integration tests"
    
    documentation_updates:
      - file: "docs/operations/publish-cortex.md"
        updates: ["Example commands with new paths"]
      
      - file: "docs/operations/optimize-cortex.md"
        updates: ["Example commands with new paths"]
      
      - file: "docs/operations/design-sync.md"
        updates: ["Example commands with new paths"]
      
      - file: "docs/getting-started/setup-guide.md"
        updates: ["NO CHANGE - setup scripts stay in scripts/"]
      
      - file: "README.md"
        updates: ["Admin scripts section: Point to cortex-brain/admin/scripts/"]
      
      - file: "cortex-brain/admin/README.md"
        updates: ["Add structure overview with all categories"]
    
    import_path_refactoring:
      pattern: "from scripts.{module} import"
      replace_with: "from cortex_brain.admin.{category}.{module} import"
      affected_files: 28
      validation: "pytest tests/ --import-mode=importlib"
  
  validation_steps:
    - step: 1
      action: "Verify all git mv operations"
      command: "git status | grep 'renamed:'"
      expected: "All file moves listed"
    
    - step: 2
      action: "Check import paths"
      command: "grep -r 'from scripts\\.' src/ tests/"
      expected: "Zero results (all imports updated)"
    
    - step: 3
      action: "Run full test suite"
      command: "pytest tests/ -v --tb=short"
      expected: "834 tests passing (critical - HIGH RISK phase)"
    
    - step: 4
      action: "Test operation execution"
      command: "python -m src.operations.execute_operation_impl 'status'"
      expected: "Status operation executes successfully"
    
    - step: 5
      action: "Test VS Code tasks"
      command: "code --task publish --dry-run"
      expected: "Task locates script at new path"
    
    - step: 6
      action: "Validate cortex-operations.yaml"
      command: "python cortex-brain/admin/scripts/validation/validate_operations_yaml.py"
      expected: "All executor paths resolve"
    
    - step: 7
      action: "Check for hardcoded paths"
      command: "grep -r 'scripts/' --include='*.py' --include='*.yaml' src/ cortex-brain/"
      expected: "Only user-facing scripts (setup, capture, cli)"
  
  migration_script:
    file: "cortex-brain/admin/scripts/migration/phase_3_path_updater.py"
    purpose: "Automated path updates across 52 files"
    features:
      - "Regex-based search/replace"
      - "Dry-run mode (preview changes)"
      - "Rollback capability"
      - "Validation after each update"
    usage: |
      # Dry run first
      python cortex-brain/admin/scripts/migration/phase_3_path_updater.py --dry-run
      
      # Execute updates
      python cortex-brain/admin/scripts/migration/phase_3_path_updater.py --execute
      
      # Rollback if issues
      python cortex-brain/admin/scripts/migration/phase_3_path_updater.py --rollback
  
  rollback_procedure:
    if_issues_encountered:
      - "STOP IMMEDIATELY - Do not proceed to Phase 4"
      - "git reset --hard HEAD~1  # Undo Phase 3 commit"
      - "pytest tests/ -v  # Verify rollback successful"
      - "Analyze failures: pytest --lf -vv"
      - "Document root cause in phase_3_rollback_notes.md"
      - "Re-plan Phase 3 with smaller batches"
    
    batch_rollback_strategy:
      description: "If full rollback needed, break Phase 3 into sub-phases"
      sub_phases:
        - "3a: Move operation executors only (3 files)"
        - "3b: Update import paths in src/ (28 files)"
        - "3c: Update cortex-operations.yaml (13 operations)"
        - "3d: Move metrics/simulations/archives (3 folders)"
  
  completion_criteria:
    - "✓ All admin operations/metrics/simulations moved"
    - "✓ 52 path references updated across codebase"
    - "✓ Test suite passes (834/834) - CRITICAL"
    - "✓ Operations execute with new paths"
    - "✓ VS Code tasks work with new paths"
    - "✓ No hardcoded 'scripts/' paths (except user-facing)"
    - "✓ Import validation passes"

# ============================================================================
# PHASE 4: Comprehensive Validation & Completion (LOW RISK)
# ============================================================================

phase_4:
  name: "Final Validation & Documentation"
  duration: "1-2 hours"
  risk_level: "low"
  dependencies: ["phase_3_complete"]
  rationale: |
    Comprehensive validation to ensure migration succeeded:
    - No broken references
    - All operations functional
    - Documentation accurate
    - System health verified
    - Production publish configured
  
  validation_checklist:
    structural_validation:
      - action: "Verify all directories created"
        command: "ls -R cortex-brain/admin/"
        expected: "15 directories present"
        success_criteria: "All target directories exist"
      
      - action: "Count migrated files"
        command: "find cortex-brain/admin -type f | wc -l"
        expected: "70+ files"
        success_criteria: "All admin files relocated"
      
      - action: "Check for orphaned files"
        command: "find cortex-brain -maxdepth 1 -name '*-report.json' -o -name '*-logs'"
        expected: "Zero results"
        success_criteria: "No admin files left in root"
    
    functional_validation:
      - action: "Test suite full run"
        command: "pytest tests/ -v --cov=src --cov-report=term"
        expected: "834/834 passing, 0 failures"
        success_criteria: "100% test pass rate"
      
      - action: "Execute each operation"
        operations_to_test:
          - "status"
          - "optimize_cortex --dry-run"
          - "design_sync --mode quick"
          - "cleanup --profile quick --dry-run"
        expected: "All operations execute successfully"
        success_criteria: "Zero operation failures"
      
      - action: "Test admin scripts directly"
        scripts_to_test:
          - "cortex-brain/admin/scripts/validation/verify_brain_health.py --quick"
          - "cortex-brain/admin/scripts/optimization/token_counter.py cortex-brain/response-templates.yaml"
          - "cortex-brain/admin/scripts/publishing/verify_publish_package.py --dry-run"
        expected: "All scripts execute successfully"
        success_criteria: "Zero script failures"
      
      - action: "VS Code tasks validation"
        command: "code --list-tasks"
        expected: "All tasks load without errors"
        success_criteria: "Tasks available in VS Code"
    
    reference_validation:
      - action: "Search for old script paths"
        command: |
          grep -r 'scripts/publish_cortex' --include='*.py' --include='*.yaml' --include='*.md' .
          grep -r 'scripts/optimize_cortex' --include='*.py' --include='*.yaml' --include='*.md' .
          grep -r 'scripts/cleanup_orchestrator' --include='*.py' --include='*.yaml' --include='*.md' .
        expected: "Zero results (or only in migration docs)"
        success_criteria: "No broken path references"
      
      - action: "Validate import paths"
        command: "python -c 'from cortex_brain.admin.scripts.publishing.publish_cortex import main'"
        expected: "No ImportError"
        success_criteria: "All imports resolve"
      
      - action: "Check cortex-operations.yaml integrity"
        command: "python cortex-brain/admin/scripts/validation/validate_operations_yaml.py"
        expected: "All operations valid, all executors found"
        success_criteria: "Operations configuration valid"
    
    documentation_validation:
      - action: "Verify all READMEs created"
        required_readmes:
          - "cortex-brain/admin/README.md"
          - "cortex-brain/admin/documentation/README.md"
          - "cortex-brain/admin/reports/README.md"
          - "cortex-brain/admin/logs/README.md"
          - "cortex-brain/admin/exports/README.md"
          - "cortex-brain/admin/scripts/README.md"
          - "cortex-brain/admin/scripts/documentation/README.md"
          - "cortex-brain/admin/scripts/publishing/README.md"
          - "cortex-brain/admin/scripts/optimization/README.md"
          - "cortex-brain/admin/scripts/validation/README.md"
          - "cortex-brain/admin/scripts/maintenance/README.md"
          - "cortex-brain/admin/scripts/migration/README.md"
          - "cortex-brain/admin/scripts/utilities/README.md"
          - "cortex-brain/admin/operations/README.md"
          - "cortex-brain/admin/metrics/README.md"
        command: "for f in $READMES; do [ -f $f ] || echo MISSING: $f; done"
        expected: "All READMEs present"
        success_criteria: "15 READMEs exist"
      
      - action: "Check documentation accuracy"
        files_to_review:
          - "docs/operations/*.md"
          - "docs/getting-started/setup-guide.md"
          - "README.md"
        expected: "All paths updated to new admin structure"
        success_criteria: "Documentation matches reality"
    
    publish_configuration_validation:
      - action: "Verify publish exclusions"
        file: "cortex-brain/publish-config.yaml"
        required_exclusions:
          - "cortex-brain/admin/**"
          - "!cortex-brain/admin/README.md"
        validation_command: "grep -A5 'exclude_patterns:' cortex-brain/publish-config.yaml"
        expected: "Admin folder excluded from production publish"
        success_criteria: "Exclusion patterns present"
      
      - action: "Test publish dry-run"
        command: "python cortex-brain/admin/scripts/publishing/publish_cortex.py --dry-run"
        expected: "Admin files NOT in publish package"
        success_criteria: "Admin exclusion working"
      
      - action: "Verify critical files included"
        command: "python cortex-brain/admin/scripts/publishing/verify_publish_package.py --dry-run"
        expected: |
          Included: response-templates.yaml, brain-protection-rules.yaml, cortex-operations.yaml
          Excluded: admin/**, health-reports/**, cleanup-logs/**
        success_criteria: "Correct files in production package"
  
  final_documentation_updates:
    - file: "cortex-brain/admin/README.md"
      content: |
        # CORTEX Admin Features
        
        **Purpose:** Internal administration tools, scripts, and reports for CORTEX maintainers.
        
        **NOT included in production publish** - these are for framework development only.
        
        ## Directory Structure
        
        ```
        admin/
        ├── documentation/          # Generated docs from EPM system
        │   ├── generated/          # Output files (CORTEX-OPERATIONS.md, etc.)
        │   └── templates/          # Doc generation templates
        ├── scripts/                # 27 admin scripts organized by function
        │   ├── documentation/      # EPM doc generation (5 scripts)
        │   ├── publishing/         # Production packaging (3 scripts)
        │   ├── optimization/       # Token/YAML/plugin analysis (5 scripts)
        │   ├── validation/         # Health checks, governance (4 scripts)
        │   ├── maintenance/        # Cleanup, archival (4 scripts)
        │   ├── migration/          # Data transfer, DB migration (3 scripts)
        │   └── utilities/          # General tools (3 scripts)
        ├── operations/             # Operation execution infrastructure
        │   ├── executors/          # Core operation executors
        │   └── orchestrators/      # High-level workflow orchestrators
        ├── reports/                # System health and optimization reports
        │   ├── health/             # Brain health reports
        │   └── optimization/       # Token/YAML optimization results
        ├── logs/                   # Operation logs (excluded from git)
        │   ├── operations/         # Admin operation logs
        │   └── cleanup/            # Cleanup operation logs
        ├── exports/                # Brain exports and backups
        ├── metrics/                # Internal metrics (dev telemetry)
        ├── simulations/            # Testing simulations (dev only)
        └── archives/               # Historical backups
        ```
        
        ## Migration History
        
        - **Date:** 2025-11-18
        - **Migrated Files:** 70
        - **Migration Plan:** cortex-brain/documents/planning/admin-structure-migration-plan.yaml
        - **Phases:** 4 (documentation → scripts → operations → validation)
        - **Total Duration:** 13-15 hours
        
        ## Production Publish Exclusion
        
        Admin features are excluded from production CORTEX packages:
        - Users don't need internal admin tools
        - Reduces package size
        - Protects internal implementation details
        
        See `cortex-brain/publish-config.yaml` for exclusion configuration.
    
    - file: "README.md"
      section: "For Maintainers"
      content: |
        ## For Maintainers
        
        ### Admin Features
        
        All admin tools centralized in `cortex-brain/admin/`:
        - **Scripts:** 27 admin utilities in `admin/scripts/` (documentation, publishing, optimization, validation, maintenance, migration, utilities)
        - **Reports:** System health and optimization analysis in `admin/reports/`
        - **Documentation:** Generated docs from EPM system in `admin/documentation/`
        - **Operations:** Execution infrastructure in `admin/operations/`
        - **Metrics:** Internal telemetry in `admin/metrics/`
        
        See `cortex-brain/admin/README.md` for complete structure.
        
        ### User-Facing Scripts
        
        These remain in `scripts/` folder for user accessibility:
        - `cortex_setup.py` - First-time setup
        - `cortex-capture.ps1` - Conversation capture
        - `cortex_cli.py` - Command-line interface
    
    - file: "cortex-brain/documents/planning/ADMIN-MIGRATION-COMPLETE.md"
      content: |
        # Admin Structure Migration - Completion Report
        
        **Date:** 2025-11-18
        **Status:** ✅ COMPLETE
        **Duration:** [ACTUAL HOURS]
        **Test Pass Rate:** 834/834 (100%)
        
        ## Summary
        
        Successfully migrated 70 admin files to centralized `cortex-brain/admin/` structure.
        
        ## Phases Completed
        
        - ✅ **Phase 1:** Documentation outputs, reports, logs (3-4 hours, LOW RISK)
        - ✅ **Phase 2:** Admin scripts migration (4-5 hours, MEDIUM RISK)
        - ✅ **Phase 3:** Operations, metrics, path refactoring (4-5 hours, HIGH RISK)
        - ✅ **Phase 4:** Comprehensive validation (1-2 hours, LOW RISK)
        
        ## Files Migrated
        
        - Documentation outputs: 5 files → `admin/documentation/generated/`
        - Health reports: [N] files → `admin/reports/health/`
        - Optimization reports: [N] files → `admin/reports/optimization/`
        - Cleanup logs: [N] files → `admin/logs/operations/`
        - Admin scripts: 27 files → `admin/scripts/[7 categories]/`
        - Operation executors: 3 files → `admin/operations/executors/`
        - Orchestrators: 2 files → `admin/operations/orchestrators/`
        - Metrics: [N] files → `admin/metrics/`
        - Simulations: [N] files → `admin/simulations/`
        - Archives: [N] files → `admin/archives/`
        
        ## Path Updates
        
        - cortex-operations.yaml: 13 operation executors
        - .vscode/tasks.json: 4 task commands
        - src/ imports: 28 files
        - tests/ imports: 15 files
        - Documentation: 10 files
        
        ## Validation Results
        
        - ✅ Test suite: 834/834 passing (0 failures)
        - ✅ Operations: All 13 operations execute successfully
        - ✅ Admin scripts: All 27 scripts execute successfully
        - ✅ Import paths: All imports resolve
        - ✅ Path references: Zero broken references
        - ✅ Publish exclusion: Admin folder excluded from production
        
        ## Benefits Achieved
        
        - ✅ Centralized admin features (easy discovery)
        - ✅ Clean separation: admin vs user-facing
        - ✅ Production publish simplified (exclude admin/**)
        - ✅ Logical categorization (7 script categories)
        - ✅ Git history preserved (all git mv operations)
        
        ## Next Steps
        
        1. Monitor system health post-migration
        2. Update CI/CD pipelines if needed
        3. Communicate new structure to team
        4. Archive migration plan for future reference
  
  git_operations:
    - action: "Create migration completion commit"
      command: |
        git add .
        git commit -m "feat(admin): Complete admin structure migration (Phases 1-4)
        
        Centralized 70 admin files under cortex-brain/admin/:
        - Documentation outputs → admin/documentation/
        - Health/optimization reports → admin/reports/
        - Operation logs → admin/logs/
        - 27 admin scripts → admin/scripts/[7 categories]
        - Operation executors → admin/operations/
        - Metrics/simulations → admin/metrics/, admin/simulations/
        
        Path updates:
        - cortex-operations.yaml (13 operations)
        - .vscode/tasks.json (4 tasks)
        - src/ imports (28 files)
        - tests/ imports (15 files)
        
        Validation: 834/834 tests passing
        Publish exclusion: admin/** excluded from production
        
        Migration plan: cortex-brain/documents/planning/admin-structure-migration-plan.yaml
        Phases: documentation (3-4h) → scripts (4-5h) → operations (4-5h) → validation (1-2h)
        Total duration: 13-15 hours
        
        Closes: #CC03-DocOrg"
    
    - action: "Create backup tag"
      command: "git tag admin-migration-complete-2025-11-18"
    
    - action: "Push changes"
      command: "git push origin CORTEX-3.0 --tags"
  
  completion_criteria:
    structural:
      - "✓ All 15 admin directories created"
      - "✓ All 70 files migrated with git mv"
      - "✓ All 15 READMEs created"
      - "✓ Git history preserved"
    
    functional:
      - "✓ Test suite: 834/834 passing (100%)"
      - "✓ All 13 operations execute successfully"
      - "✓ All 27 admin scripts execute successfully"
      - "✓ VS Code tasks functional"
    
    reference:
      - "✓ Zero broken path references"
      - "✓ All import paths resolve"
      - "✓ cortex-operations.yaml valid"
      - "✓ Documentation accurate"
    
    publish:
      - "✓ Admin folder excluded from production publish"
      - "✓ Exclusion patterns in publish-config.yaml"
      - "✓ Publish dry-run successful"
      - "✓ Critical files included in package"
    
    documentation:
      - "✓ cortex-brain/admin/README.md complete"
      - "✓ README.md updated with admin structure"
      - "✓ Operation docs updated with new paths"
      - "✓ Migration completion report created"

# ============================================================================
# EXECUTION GUIDE
# ============================================================================

execution_guide:
  prerequisites:
    - "Create git branch: git checkout -b admin-migration"
    - "Create backup tag: git tag admin-migration-backup"
    - "Run baseline test suite: pytest tests/ -v (verify 834 passing)"
    - "Create backup: tar -czf admin-migration-backup.tar.gz cortex-brain/"
  
  phase_execution_order:
    - phase: 1
      duration: "3-4 hours"
      checklist:
        - "Create admin directories"
        - "Move documentation outputs, reports, logs"
        - "Create Phase 1 READMEs"
        - "Run test suite (expect 834 passing)"
        - "Commit Phase 1: git commit -m 'feat(admin): Phase 1 - Documentation/reports/logs'"
    
    - phase: 2
      duration: "4-5 hours"
      checklist:
        - "Create script category directories"
        - "Move 27 admin scripts to categories"
        - "Update paths in tasks.json, operations.yaml"
        - "Create Phase 2 READMEs"
        - "Run test suite (expect 834 passing)"
        - "Test one admin script"
        - "Commit Phase 2: git commit -m 'feat(admin): Phase 2 - Admin scripts migration'"
    
    - phase: 3
      duration: "4-5 hours"
      checklist:
        - "Move operation executors, orchestrators"
        - "Move metrics, simulations, archives"
        - "Update 52 path references"
        - "Run comprehensive validation"
        - "Run test suite (expect 834 passing - CRITICAL)"
        - "Test all operations"
        - "Commit Phase 3: git commit -m 'feat(admin): Phase 3 - Operations/metrics/path refactoring'"
    
    - phase: 4
      duration: "1-2 hours"
      checklist:
        - "Run validation checklist (structural, functional, reference, publish)"
        - "Create all remaining READMEs"
        - "Update cortex-brain/admin/README.md"
        - "Update README.md"
        - "Create migration completion report"
        - "Update publish-config.yaml with exclusions"
        - "Test publish dry-run"
        - "Commit Phase 4: git commit -m 'feat(admin): Phase 4 - Final validation & documentation'"
  
  post_migration:
    - "Review migration completion report"
    - "Merge to main: git checkout CORTEX-3.0 && git merge admin-migration"
    - "Push: git push origin CORTEX-3.0"
    - "Tag: git tag admin-migration-complete-2025-11-18 && git push --tags"
    - "Communicate new structure to team"
    - "Archive migration plan"
    - "Monitor system health for 24 hours"
  
  emergency_rollback:
    trigger_conditions:
      - "Test suite fails (<834 passing)"
      - "Operations fail to execute"
      - "Import errors cannot be resolved"
      - "Critical production issue detected"
    
    rollback_steps:
      - "STOP IMMEDIATELY"
      - "git reset --hard admin-migration-backup"
      - "pytest tests/ -v  # Verify rollback successful"
      - "Document issue in rollback-notes.md"
      - "Analyze root cause"
      - "Re-plan migration with smaller batches"

# ============================================================================
# CONCLUSION
# ============================================================================

conclusion:
  summary: |
    Comprehensive 4-phase migration plan to centralize 70 admin files under
    cortex-brain/admin/ structure. Phased approach minimizes risk through
    incremental validation. High-risk path refactoring isolated to Phase 3
    with detailed rollback procedures.
  
  key_principles:
    - "Incremental phases with validation checkpoints"
    - "Git mv to preserve history"
    - "Test-driven migration (834 tests must pass after each phase)"
    - "User-facing scripts stay accessible (scripts/ folder)"
    - "Admin features excluded from production publish"
    - "Comprehensive documentation at every step"
  
  success_definition: |
    Migration complete when:
    1. All 70 admin files relocated to admin/ hierarchy
    2. Test suite: 834/834 passing (100%)
    3. All operations execute successfully
    4. Zero broken path references
    5. Admin folder excluded from production publish
    6. Documentation accurate and complete
  
  estimated_total: "13-15 hours"
  risk_mitigation: "Phased approach, validation checkpoints, rollback procedures"
  maintainability: "READMEs in all admin subfolders, logical categorization"
