%% CORTEX Multi-Agent Coordination Sequence
%% Shows agent collaboration for feature implementation

sequenceDiagram
    participant User
    participant IR as Intent Router
    participant WP as Work Planner
    participant CC as Corpus Callosum
    participant CE as Code Executor
    participant TG as Test Generator
    participant HV as Health Validator
    participant CH as Commit Handler
    participant T2 as Tier 2 (KG)

    User->>IR: "Add user authentication"
    IR->>IR: Parse intent (PLAN)
    IR->>T2: Search similar patterns
    T2-->>IR: Found: auth_workflow (0.85 confidence)
    IR->>WP: Route to Work Planner
    
    WP->>WP: Create 4-phase plan
    WP->>CC: Post plan to queue
    CC-->>User: Plan ready for review
    
    User->>CC: "Start Phase 1"
    CC->>TG: Phase 1: Create tests
    TG->>TG: Generate LoginTests.cs
    TG-->>CC: Tests created (RED)
    CC-->>User: Phase 1 complete (tests failing âœ…)
    
    User->>CC: "Continue"
    CC->>CE: Phase 2: Implement
    CE->>CE: Create AuthService.cs
    CE->>TG: Run tests
    TG-->>CE: Tests pass (GREEN) âœ…
    CE-->>CC: Implementation complete
    
    CC->>HV: Phase 3: Validate
    HV->>HV: Check errors/warnings
    HV->>HV: Run full test suite
    HV-->>CC: All checks pass âœ…
    
    CC->>CH: Phase 4: Commit
    CH->>CH: Create semantic message
    CH->>CH: Git commit
    CH-->>CC: Committed with tag
    
    CC->>T2: Store workflow pattern
    T2->>T2: Update confidence (0.85 â†’ 0.90)
    CC-->>User: Feature complete ğŸ‰
