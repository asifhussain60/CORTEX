# CORTEX Pre-Commit Hooks
# =======================
# Automated code quality checks before commits
# 
# Installation:
#   pip install pre-commit
#   pre-commit install
#
# Manual run:
#   pre-commit run --all-files

repos:
  # Standard Python formatting
  - repo: https://github.com/psf/black
    rev: 23.12.1
    hooks:
      - id: black
        language_version: python3
        args: [--line-length=100]

  # Import sorting
  - repo: https://github.com/pycqa/isort
    rev: 5.13.2
    hooks:
      - id: isort
        args: [--profile=black, --line-length=100]

  # Flake8 linting
  - repo: https://github.com/pycqa/flake8
    rev: 7.0.0
    hooks:
      - id: flake8
        args: [--max-line-length=100, --extend-ignore=E203]

  # Type checking with mypy
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy
        additional_dependencies: [types-PyYAML]
        args: [--ignore-missing-imports]

  # YAML validation
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: check-yaml
        args: [--safe]
      - id: end-of-file-fixer
      - id: trailing-whitespace
      - id: check-added-large-files
        args: [--maxkb=500]

  # Pylint (comprehensive code analysis)
  - repo: local
    hooks:
      - id: pylint
        name: pylint
        entry: python -m pylint
        language: system
        types: [python]
        args:
          - --max-line-length=100
          - --disable=C0111,C0103,R0903  # Missing docstring, invalid name, too few public methods
          - --score=no

  # Radon complexity check
  - repo: local
    hooks:
      - id: radon-complexity
        name: radon-complexity
        entry: python -m radon cc
        language: system
        types: [python]
        args:
          - --min=B  # Warn on complexity B or worse (A=simple, F=very complex)
          - --show-complexity
        pass_filenames: true
        verbose: true

  # Vulture dead code detection
  - repo: local
    hooks:
      - id: vulture
        name: vulture
        entry: python -m vulture
        language: system
        types: [python]
        args:
          - --min-confidence=80  # Only report high-confidence dead code
        pass_filenames: true

  # CORTEX-specific optimizer
  - repo: local
    hooks:
      - id: cortex-optimizer
        name: cortex-optimizer
        entry: python scripts/admin/cortex_optimizer.py analyze --report json
        language: system
        pass_filenames: false
        stages: [manual]  # Only run on manual invocation, not auto
        verbose: true

# Exclude patterns
exclude: |
  (?x)^(
      \.venv/.*|
      \.git/.*|
      __pycache__/.*|
      .*\.pyc|
      tests/fixtures/.*|
      cortex-brain/.*\.db|
      node_modules/.*|
      publish/.*
  )$
