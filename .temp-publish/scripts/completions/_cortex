#compdef cortex-capture cortex-bug cortex-feature cortex-resume cortex-recall cortex
# CORTEX Shell Completions for Zsh
# 
# Installation:
#   Add to ~/.zshrc:
#   fpath=(/path/to/CORTEX/scripts/completions $fpath)
#   autoload -Uz compinit && compinit
#
# Or copy to zsh completions directory:
#   cp _cortex-* /usr/local/share/zsh/site-functions/
#
# Author: Asif Hussain
# Copyright: © 2024-2025 Asif Hussain. All rights reserved.
# Phase: Phase 4.2 - Shell Integration

# cortex-capture completion
_cortex-capture() {
    local -a types
    types=(
        'feature:Feature implementation'
        'bug:Bug fix'
        'refactor:Code refactoring'
        'general:General work'
    )
    
    _arguments \
        '1:summary:' \
        '--type[Type of capture]:type:->types' \
        '--tags[Comma-separated tags]:tags:' \
        '(-i --interactive)'{-i,--interactive}'[Interactive mode]' \
        '--repo[Repository path]:directory:_directories' \
        '(-h --help)'{-h,--help}'[Show help]'
    
    case "$state" in
        types)
            _describe 'capture type' types
            ;;
    esac
}

# cortex-bug completion
_cortex-bug() {
    local -a severities
    severities=(
        'low:Minor issue'
        'medium:Normal bug'
        'high:Significant issue'
        'critical:Blocking issue'
    )
    
    _arguments \
        '1:description:' \
        '--severity[Bug severity]:severity:->severities' \
        '--error[Error message]:error:' \
        '--files[Affected files]:files:_files' \
        '(-i --interactive)'{-i,--interactive}'[Interactive mode]' \
        '--repo[Repository path]:directory:_directories' \
        '(-h --help)'{-h,--help}'[Show help]'
    
    case "$state" in
        severities)
            _describe 'severity level' severities
            ;;
    esac
}

# cortex-feature completion
_cortex-feature() {
    _arguments \
        '1:description:' \
        '--components[Components affected]:components:' \
        '(-t --tests)'{-t,--tests}'[Tests were added]' \
        '(-i --interactive)'{-i,--interactive}'[Interactive mode]' \
        '--repo[Repository path]:directory:_directories' \
        '(-h --help)'{-h,--help}'[Show help]'
}

# cortex-resume completion
_cortex-resume() {
    _arguments \
        '(-l --last)'{-l,--last}'[Number of conversations]:count:(1 3 5 10)' \
        '(-s --search)'{-s,--search}'[Search query]:query:' \
        '--limit[Search result limit]:limit:(5 10 20 50)' \
        '(-i --interactive)'{-i,--interactive}'[Interactive mode]' \
        '--repo[Repository path]:directory:_directories' \
        '(-h --help)'{-h,--help}'[Show help]'
}

# cortex-recall completion (new command)
_cortex-recall() {
    local -a types formats
    types=(
        'feature:Feature implementations'
        'bug:Bug fixes'
        'refactor:Refactorings'
        'general:General work'
        'all:All types'
    )
    formats=(
        'short:Brief summary'
        'full:Full details'
        'json:JSON output'
    )
    
    _arguments \
        '1:query:' \
        '--type[Filter by type]:type:->types' \
        '--limit[Result limit]:limit:(5 10 20 50)' \
        '--format[Output format]:format:->formats' \
        '--repo[Repository path]:directory:_directories' \
        '(-h --help)'{-h,--help}'[Show help]'
    
    case "$state" in
        types)
            _describe 'conversation type' types
            ;;
        formats)
            _describe 'output format' formats
            ;;
    esac
}

# Main cortex command completion
_cortex() {
    local -a commands
    commands=(
        'capture:Quick context capture'
        'bug:Report a bug'
        'feature:Log a feature'
        'resume:Resume last conversation'
        'recall:Search conversation history'
        'setup:Initialize CORTEX'
        'status:Show system status'
        'help:Show help'
    )
    
    _arguments \
        '1:command:->commands' \
        '(-h --help)'{-h,--help}'[Show help]' \
        '--version[Show version]'
    
    case "$state" in
        commands)
            _describe 'cortex command' commands
            ;;
    esac
}

# Register completions
compdef _cortex-capture cortex-capture
compdef _cortex-bug cortex-bug
compdef _cortex-feature cortex-feature
compdef _cortex-resume cortex-resume
compdef _cortex-recall cortex-recall
compdef _cortex cortex

# Success message
print "✅ CORTEX shell completions loaded (zsh)"
