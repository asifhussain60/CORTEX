# KDS Team Intelligence Configuration
# Version: 1.0
# Purpose: Configure Pull Request intelligence for team environments
# Status: Optional feature (auto-disables for solo developers)

# ============================================================================
# MASTER SWITCH
# ============================================================================
team_intelligence:
  # Enable/disable all team intelligence features
  # Default: false (solo developer mode)
  # Auto-detection: Switches to true if multiple git authors detected in last 30 days
  enabled: false
  
  # Auto-detection settings
  auto_detection:
    enabled: true
    lookback_days: 30
    min_authors_for_team_mode: 2
    # If only 1 author found, team intelligence auto-disables

# ============================================================================
# PR DETECTION SETTINGS
# ============================================================================
pr_detection:
  enabled: true
  
  # Patterns to identify PR merge commits in git history
  merge_commit_patterns:
    - "Merge pull request #"
    - "Merged PR #"
    - "Merge branch 'pr/"
    - "Pull request #"
    - "^Merge: .* into"  # Generic merge commit pattern
  
  # Branch naming patterns for PR branches
  branch_patterns:
    - "pr/*"
    - "pull/*"
    - "review/*"
    - "feature/*"  # Some teams use feature/ for PRs
  
  # How far back to analyze PR history
  lookback_days: 30
  
  # Minimum PRs needed for meaningful pattern detection
  min_prs_for_patterns: 3
  
  # PR categorization (maps file paths to categories)
  categories:
    ui:
      patterns:
        - "**/*.razor"
        - "**/*.cshtml"
        - "**/*.html"
        - "**/*.css"
        - "**/*.scss"
      label: "UI"
    
    backend:
      patterns:
        - "**/*.cs"
        - "SPA/**/Services/**"
        - "SPA/**/Controllers/**"
      label: "Backend"
    
    tests:
      patterns:
        - "Tests/**"
        - "**/*.spec.ts"
        - "**/*.test.js"
        - "**/test-*.ps1"
      label: "Tests"
    
    docs:
      patterns:
        - "Docs/**"
        - "**/*.md"
        - "DocFX/**"
      label: "Documentation"
    
    config:
      patterns:
        - "**/*.json"
        - "**/*.yaml"
        - "**/*.yml"
        - "**/appsettings*.json"
      label: "Configuration"
    
    kds:
      patterns:
        - "KDS/**"
      label: "KDS"

# ============================================================================
# PRIVACY SETTINGS
# ============================================================================
privacy:
  # Anonymize developer names/emails in PR data
  # Useful for larger teams or when sharing BRAIN data
  anonymize_authors: false
  
  # When anonymizing, use these labels
  author_labels:
    format: "developer{n}"  # Results in: developer1, developer2, etc.
  
  # Exclude external contributors (non-team members)
  # Useful if you accept PRs from external contributors
  exclude_external_contributors: false
  
  # List of external domains to exclude (when exclude_external_contributors = true)
  external_domains:
    - "users.noreply.github.com"
    - "dependabot[bot]"
  
  # Store raw PR data locally (for debugging)
  # Set to false to only keep aggregated patterns
  store_raw_pr_data: true
  
  # Raw data retention (days)
  raw_data_retention_days: 90

# ============================================================================
# RECOMMENDATION SETTINGS
# ============================================================================
recommendations:
  # Show warnings about files that historically require rework
  show_review_warnings: true
  
  # Threshold for "high rework" warning
  high_rework_threshold: 2.0  # Average review iterations
  
  # Show PR cycle time estimates during planning
  show_cycle_time_estimates: true
  
  # Show collaboration suggestions (files often changed together)
  show_collaboration_suggestions: true
  
  # Minimum co-modification rate to suggest related files
  collaboration_threshold: 0.6  # 60% of the time
  
  # Show team velocity trends
  show_velocity_trends: true
  
  # Warn if current work deviates from team patterns
  show_deviation_warnings: true
  
  # Minimum confidence score to show recommendations
  min_confidence: 0.5

# ============================================================================
# COLLECTION SETTINGS
# ============================================================================
collection:
  # When to collect PR intelligence
  triggers:
    # Collect during Tier 3 development context updates
    during_tier3_collection: true
    
    # Collect during brain updates
    during_brain_update: true
    
    # Manual trigger available
    manual_trigger_enabled: true
  
  # Throttling (same as Tier 3 - only collect if >1 hour since last)
  throttle:
    enabled: true
    min_hours_between_collections: 1
  
  # Performance limits
  performance:
    max_prs_to_analyze: 50  # Don't analyze more than 50 PRs
    max_commits_to_scan: 500  # Stop scanning after 500 commits
    timeout_seconds: 30  # Abort collection if takes >30 seconds

# ============================================================================
# BRAIN INTEGRATION
# ============================================================================
brain_integration:
  # Update Tier 2 (Knowledge Graph) with PR patterns
  update_knowledge_graph: true
  
  # Update Tier 3 (Development Context) with PR metrics
  update_development_context: true
  
  # Confidence scoring for PR-derived patterns
  confidence_scoring:
    # High confidence: Direct observation from git history
    direct_observation: 0.90
    
    # Medium confidence: Statistical inference (>10 PRs)
    statistical_inference: 0.70
    
    # Low confidence: Limited data (<5 PRs)
    limited_data: 0.50
  
  # Pattern types to extract
  pattern_types:
    - high_rework_files
    - fast_track_files
    - collaboration_hotspots
    - quality_indicators
    - velocity_trends

# ============================================================================
# ROUTER & PLANNER INTEGRATION
# ============================================================================
agent_integration:
  # Router: Include PR warnings in intent routing context
  router:
    include_pr_warnings: true
    show_rework_probability: true
  
  # Planner: Use PR cycle times for estimates
  planner:
    use_pr_cycle_times: true
    adjust_estimates_for_team: true
    include_review_buffer: true
    
    # Estimate adjustments
    review_buffer_multiplier: 1.3  # Add 30% to solo estimates for team review
  
  # Executor: Show collaboration hints during file selection
  executor:
    show_related_files: true
    warn_about_hotspots: true

# ============================================================================
# METRICS & REPORTING
# ============================================================================
metrics:
  # Calculate these metrics from PR history
  calculate:
    - cycle_time_avg
    - cycle_time_median
    - review_iterations_avg
    - pr_size_avg
    - files_per_pr_avg
    - commits_per_pr_avg
    - test_coverage_trend
    - rework_rate
  
  # Reporting
  reporting:
    # Include PR metrics in health-validator reports
    include_in_health_reports: true
    
    # Include PR trends in metrics-reporter
    include_in_metrics_reporter: true
    
    # Show team comparisons (if multiple teams)
    show_team_comparisons: false

# ============================================================================
# FALLBACK BEHAVIOR
# ============================================================================
fallback:
  # If PR detection fails or no PRs found
  on_no_prs_detected:
    # Continue with solo developer mode
    disable_team_features: true
    
    # Log the detection failure
    log_detection_failure: true
  
  # If git commands fail
  on_git_error:
    # Disable PR intelligence for this session
    disable_for_session: true
    
    # Retry on next collection
    retry_next_collection: true

# ============================================================================
# EXAMPLES & DOCUMENTATION
# ============================================================================
examples:
  solo_developer:
    description: "Single developer, no team features needed"
    config:
      enabled: false
      auto_detection:
        enabled: true
  
  small_team:
    description: "2-5 developers, basic team intelligence"
    config:
      enabled: true
      pr_detection:
        lookback_days: 30
      privacy:
        anonymize_authors: false
      recommendations:
        show_review_warnings: true
        show_cycle_time_estimates: true
  
  large_team:
    description: "5+ developers, full intelligence + privacy"
    config:
      enabled: true
      pr_detection:
        lookback_days: 60
      privacy:
        anonymize_authors: true
      recommendations:
        show_all: true
      metrics:
        calculate_all: true

# ============================================================================
# NOTES
# ============================================================================
# - All PR data stays LOCAL (no external API calls)
# - Uses git history only (no GitHub/GitLab integration)
# - Opt-in by default (auto-enables for teams)
# - Zero overhead for solo developers
# - <1 second overhead for team environments
# - Fully privacy-preserving (local storage only)
