# Validation Rules Configuration
# Defines validation rules for pre-flight and post-generation checks
#
# Author: Asif Hussain
# Copyright: Â© 2024-2025 Asif Hussain. All rights reserved.

version: "1.0"
description: "Validation rules for CORTEX 3.0 documentation generation"

# Pre-flight Validation Rules
pre_flight:
  brain_structure:
    description: "Validate cortex-brain directory structure"
    checks:
      - name: "Required directories exist"
        paths:
          - cortex-brain/
          - cortex-brain/templates/
          - cortex-brain/doc-generation-config/
        severity: critical
      
      - name: "Configuration files exist"
        paths:
          - cortex-brain/doc-generation-config/source-mapping.yaml
          - cortex-brain/doc-generation-config/diagram-definitions.yaml
          - cortex-brain/doc-generation-config/page-definitions.yaml
        severity: critical
      
      - name: "Template directory exists"
        paths:
          - cortex-brain/templates/doc-templates/
        severity: critical
  
  yaml_validation:
    description: "Validate YAML syntax and schemas"
    checks:
      - name: "Source mapping YAML is valid"
        file: cortex-brain/doc-generation-config/source-mapping.yaml
        schema: source_mapping_schema
        severity: critical
      
      - name: "Diagram definitions YAML is valid"
        file: cortex-brain/doc-generation-config/diagram-definitions.yaml
        schema: diagram_definitions_schema
        severity: critical
      
      - name: "Page definitions YAML is valid"
        file: cortex-brain/doc-generation-config/page-definitions.yaml
        schema: page_definitions_schema
        severity: critical
      
      - name: "Capabilities YAML is valid"
        file: cortex-brain/capabilities.yaml
        severity: warning
      
      - name: "Module definitions YAML is valid"
        file: cortex-brain/module-definitions.yaml
        severity: warning
  
  code_structure:
    description: "Validate Python code structure"
    checks:
      - name: "EPM modules directory exists"
        path: src/epm/modules/
        severity: critical
      
      - name: "Required modules exist"
        files:
          - src/epm/doc_generator.py
          - src/epm/modules/validation_engine.py
          - src/epm/modules/cleanup_manager.py
          - src/epm/modules/diagram_generator.py
          - src/epm/modules/page_generator.py
          - src/epm/modules/cross_reference_builder.py
        severity: critical
      
      - name: "Python files have no syntax errors"
        directory: src/
        severity: critical
  
  permissions:
    description: "Check write permissions"
    checks:
      - name: "docs/ directory is writable"
        path: docs/
        severity: critical
      
      - name: "mkdocs.yml is writable"
        path: mkdocs.yml
        severity: warning
  
  dependencies:
    description: "Check required dependencies"
    checks:
      - name: "Jinja2 is installed"
        package: jinja2
        severity: critical
      
      - name: "PyYAML is installed"
        package: yaml
        severity: critical
      
      - name: "MkDocs is installed"
        package: mkdocs
        severity: warning

# Post-generation Validation Rules
post_generation:
  content_validation:
    description: "Validate generated content"
    checks:
      - name: "All pages were generated"
        check_type: file_count
        expected_minimum: 15
        severity: critical
      
      - name: "All diagrams were generated"
        check_type: file_count
        expected_minimum: 10
        severity: critical
      
      - name: "No empty files"
        check_type: file_size
        minimum_bytes: 100
        severity: warning
  
  link_validation:
    description: "Validate internal links"
    checks:
      - name: "No broken internal links"
        check_type: link_check
        max_broken: 0
        severity: critical
      
      - name: "All diagram references valid"
        check_type: diagram_reference
        severity: critical
      
      - name: "All cross-references valid"
        check_type: cross_reference
        severity: warning
  
  markdown_validation:
    description: "Validate markdown syntax"
    checks:
      - name: "Valid markdown syntax"
        check_type: markdown_lint
        severity: warning
      
      - name: "Consistent heading levels"
        check_type: heading_structure
        severity: warning
      
      - name: "No orphaned pages"
        check_type: navigation_check
        severity: warning
  
  mkdocs_validation:
    description: "Validate MkDocs build"
    checks:
      - name: "MkDocs builds successfully"
        check_type: build_test
        severity: critical
      
      - name: "Navigation structure is valid"
        check_type: nav_validation
        severity: critical
      
      - name: "Theme renders correctly"
        check_type: theme_check
        severity: warning

# Severity Levels
severity_levels:
  critical:
    description: "Must pass - blocks generation"
    fail_action: "abort"
  
  warning:
    description: "Should pass - logs warning but continues"
    fail_action: "warn"
  
  info:
    description: "Informational - always continues"
    fail_action: "log"

# Schema Definitions (simplified)
schemas:
  source_mapping_schema:
    required_fields:
      - version
      - description
      - brain_sources
      - code_sources
  
  diagram_definitions_schema:
    required_fields:
      - version
      - description
      - diagrams
    diagram_required_fields:
      - name
      - type
      - output_path
  
  page_definitions_schema:
    required_fields:
      - version
      - description
      - pages
    page_required_fields:
      - name
      - template
      - output_path
      - data_sources
