# CORTEX Documentation Cleanup - Comprehensive Plan

**Purpose:** Remove non-generated documentation files and establish safeguards against drift  
**Author:** Asif Hussain  
**Date:** 2025-11-18  
**Status:** Planning  

---

## üéØ My Understanding Of Your Request

You want to physically delete all folders and files in the `docs/` directory that are **not** generated by the Enterprise Documentation Orchestrator, fix the system cleanly, and add tests to prevent this drift from happening again.

---

## ‚ö†Ô∏è Challenge: ‚úì Accept

This is critical maintenance. Documentation drift creates confusion, increases token usage, and makes the system unmaintainable. I'll create a comprehensive plan that:
1. Identifies generator-owned vs manual files
2. Safely removes non-generated content
3. Adds validation tests to prevent drift
4. Documents the canonical file structure

---

## üìä Current State Analysis

### Generated Files (Keep - Managed by Orchestrator)

Based on analysis of generator code:

#### Feature List Generator
- `docs/FEATURES.md`
- `docs/OPERATIONS-REFERENCE.md`
- `docs/MODULES-REFERENCE.md`
- `docs/CAPABILITIES-MATRIX.md`
- `docs/FEATURE-COMPARISON.md`

#### Executive Summary Generator
- `docs/EXECUTIVE-SUMMARY.md`

#### Diagrams Generator
- `docs/diagrams/*.mmd` (Mermaid diagram files)
- `docs/diagrams/diagram-*.md` (diagram documentation)
- `docs/diagrams/prompts/*.md` (AI image generation prompts)

#### MkDocs Generator
- `docs/index.md` (site homepage)
- Updates to `mkdocs.yml` (navigation structure)
- May generate category index pages (TBD - needs verification)

### Non-Generated Files (Delete - Manual Drift)

These files exist but are NOT produced by any generator:

#### Root-Level Manual Files
- ‚ùå `docs/DOCUMENTATION-LINKS-FIXED-REPORT.md` (one-time report)
- ‚ùå `docs/GENERATION-REPORT-*.md` (multiple report files - should be in logs/)
- ‚ùå `docs/HELP-SYSTEM.md` (manual doc)
- ‚ùå `docs/KNOWLEDGE-GRAPH-IMPORT-GUIDE.md` (manual guide)
- ‚ùå `docs/NAVIGATION-GUIDE.md` (manual guide)
- ‚ùå `docs/response-template-user-guide.md` (manual guide)
- ‚ùå `docs/Technical-Cost-Optimization.md` (manual doc)
- ‚ùå `docs/index.md.backup` (backup file)
- ‚ùå `docs/mockup-tales-styling.html` (test file)

#### Directories (Status Unknown - Need Verification)
- ‚ö†Ô∏è `docs/api/` - May contain generator output OR manual files
- ‚ö†Ô∏è `docs/architecture/` - May contain generator output OR manual files
- ‚ö†Ô∏è `docs/getting-started/` - Likely manual
- ‚ö†Ô∏è `docs/guides/` - Likely manual
- ‚ö†Ô∏è `docs/human-readable/` - Manual narratives
- ‚ö†Ô∏è `docs/operations/` - May contain generator output
- ‚ö†Ô∏è `docs/performance/` - Likely manual
- ‚ö†Ô∏è `docs/plugins/` - Likely manual
- ‚ö†Ô∏è `docs/reference/` - Likely manual
- ‚ö†Ô∏è `docs/telemetry/` - Likely manual

#### Asset Directories
- ‚úÖ `docs/assets/` - Static assets (images, CSS, JS) - Keep
- ‚úÖ `docs/images/` - Image files - Keep
- ‚úÖ `docs/stylesheets/` - CSS files - Keep
- ‚úÖ `docs/overrides/` - MkDocs theme overrides - Keep

---

## üóÇÔ∏è Canonical Structure (Target State)

After cleanup, `docs/` should contain ONLY:

```
docs/
‚îú‚îÄ‚îÄ index.md                      # [GENERATED] Site homepage
‚îú‚îÄ‚îÄ EXECUTIVE-SUMMARY.md          # [GENERATED] High-level overview
‚îú‚îÄ‚îÄ FEATURES.md                   # [GENERATED] Feature list
‚îú‚îÄ‚îÄ OPERATIONS-REFERENCE.md       # [GENERATED] Operations list
‚îú‚îÄ‚îÄ MODULES-REFERENCE.md          # [GENERATED] Modules list
‚îú‚îÄ‚îÄ CAPABILITIES-MATRIX.md        # [GENERATED] Capabilities matrix
‚îú‚îÄ‚îÄ FEATURE-COMPARISON.md         # [GENERATED] Feature comparison
‚îÇ
‚îú‚îÄ‚îÄ diagrams/                     # [GENERATED] Diagram files
‚îÇ   ‚îú‚îÄ‚îÄ *.mmd                     # Mermaid diagrams
‚îÇ   ‚îú‚îÄ‚îÄ diagram-*.md              # Diagram docs
‚îÇ   ‚îî‚îÄ‚îÄ prompts/                  # AI image prompts
‚îÇ       ‚îî‚îÄ‚îÄ *.md
‚îÇ
‚îú‚îÄ‚îÄ assets/                       # [STATIC] Images, icons
‚îú‚îÄ‚îÄ images/                       # [STATIC] Documentation images
‚îú‚îÄ‚îÄ stylesheets/                  # [STATIC] CSS files
‚îî‚îÄ‚îÄ overrides/                    # [STATIC] MkDocs theme overrides
```

**Key Points:**
- **Generated files** have `<!-- AUTO-GENERATED -->` marker
- **Static assets** (CSS, images) are kept
- **Manual guides** should move to `cortex-brain/documents/guides/`
- **Reports** should move to `cortex-brain/documents/reports/`

---

## üßπ Cleanup Phases

### Phase 1: Discovery & Verification (30 min)

**Goal:** Confirm which files are actually generated vs manual

**Tasks:**
1. ‚úÖ Scan all generator modules for output file paths
2. ‚úÖ Create definitive list of generator-owned files
3. ‚úÖ Verify generators write `<!-- AUTO-GENERATED -->` marker
4. ‚úÖ Scan existing `docs/` files for auto-generated marker
5. ‚úÖ Cross-reference: Files without marker = Manual
6. ‚úÖ Create manifest: `cleanup-manifest.json`

**Manifest Structure:**
```json
{
  "generated_files": [
    "docs/FEATURES.md",
    "docs/EXECUTIVE-SUMMARY.md",
    ...
  ],
  "manual_files": [
    "docs/HELP-SYSTEM.md",
    "docs/NAVIGATION-GUIDE.md",
    ...
  ],
  "unknown_files": [
    "docs/api/index.md",
    ...
  ],
  "static_assets": [
    "docs/assets/",
    "docs/images/",
    ...
  ]
}
```

**Output:** `cortex-brain/cleanup-reports/cleanup-manifest-2025-11-18.json`

---

### Phase 2: Safe Migration (45 min)

**Goal:** Move manual files to proper locations before deletion

**Tasks:**
1. ‚úÖ Create migration mapping
2. ‚úÖ Move manual guides ‚Üí `cortex-brain/documents/guides/`
3. ‚úÖ Move reports ‚Üí `cortex-brain/documents/reports/`
4. ‚úÖ Archive to `cortex-brain/archives/manual-docs-2025-11-18/`
5. ‚úÖ Update any links in generated files (if needed)
6. ‚úÖ Create migration report

**Migration Mapping:**
```yaml
migrations:
  - source: docs/HELP-SYSTEM.md
    destination: cortex-brain/documents/guides/HELP-SYSTEM.md
    reason: Manual user guide
  
  - source: docs/KNOWLEDGE-GRAPH-IMPORT-GUIDE.md
    destination: cortex-brain/documents/guides/KNOWLEDGE-GRAPH-IMPORT-GUIDE.md
    reason: Manual operational guide
  
  - source: docs/DOCUMENTATION-LINKS-FIXED-REPORT.md
    destination: cortex-brain/documents/reports/DOCUMENTATION-LINKS-FIXED-REPORT.md
    reason: One-time report
  
  - source: docs/GENERATION-REPORT-*.md
    destination: cortex-brain/documents/reports/
    reason: Generation reports should be in reports folder
```

**Output:** `cortex-brain/cleanup-reports/migration-report-2025-11-18.md`

---

### Phase 3: Cleanup Execution (30 min)

**Goal:** Physically delete non-generated files and empty directories

**Tasks:**
1. ‚úÖ Backup `docs/` folder entirely ‚Üí `cortex-brain/archives/docs-backup-2025-11-18/`
2. ‚úÖ Delete manual files from manifest
3. ‚úÖ Delete unknown directories after verification
4. ‚úÖ Remove empty directories
5. ‚úÖ Keep only generator-owned files + static assets
6. ‚úÖ Verify MkDocs site still builds
7. ‚úÖ Create cleanup report

**Safety Checks:**
- Dry run first (log deletions, don't execute)
- Require confirmation for each phase
- Full backup before any deletion
- Rollback script available

**Output:** `cortex-brain/cleanup-reports/cleanup-execution-report-2025-11-18.md`

---

### Phase 4: Generator Enhancement (60 min)

**Goal:** Ensure generators explicitly mark their output

**Tasks:**
1. ‚úÖ Add `<!-- AUTO-GENERATED -->` marker to all generators
2. ‚úÖ Add generator metadata header:
   ```markdown
   <!-- AUTO-GENERATED by DiagramsGenerator on 2025-11-18 -->
   <!-- DO NOT EDIT MANUALLY - Changes will be overwritten -->
   ```
3. ‚úÖ Update all generator classes to use marker
4. ‚úÖ Regenerate all docs to apply markers
5. ‚úÖ Verify markers present in all generated files

**Generator Updates:**
- `DiagramsGenerator`
- `FeatureListGenerator`
- `ExecutiveSummaryGenerator`
- `MkdocsGenerator`

**Output:** Updated generator code with markers

---

### Phase 5: Validation Tests (90 min)

**Goal:** Prevent drift with automated validation

**Test Suite:** `tests/integration/test_documentation_integrity.py`

**Test Cases:**

#### Test 1: No Manual Files in docs/
```python
def test_no_manual_files_in_docs():
    """Ensure all files in docs/ are generator-owned or static assets"""
    docs_path = Path("docs")
    allowed_files = load_canonical_structure()
    
    for file in docs_path.rglob("*.md"):
        assert file in allowed_files or has_autogen_marker(file), \
            f"Manual file detected: {file}"
```

#### Test 2: All Generated Files Have Markers
```python
def test_generated_files_have_markers():
    """Ensure all generator output has AUTO-GENERATED marker"""
    generated_files = get_generated_files_from_registry()
    
    for file in generated_files:
        content = file.read_text()
        assert "<!-- AUTO-GENERATED -->" in content, \
            f"Missing marker: {file}"
```

#### Test 3: No Drift in Directory Structure
```python
def test_docs_structure_matches_canonical():
    """Ensure docs/ structure matches canonical definition"""
    canonical = load_canonical_structure()
    actual = scan_docs_structure()
    
    extra_dirs = actual["dirs"] - canonical["allowed_dirs"]
    assert not extra_dirs, f"Unexpected directories: {extra_dirs}"
```

#### Test 4: Generation Reports in Correct Location
```python
def test_generation_reports_not_in_docs():
    """Generation reports should be in cleanup-reports/, not docs/"""
    docs_path = Path("docs")
    
    for file in docs_path.rglob("GENERATION-REPORT-*.md"):
        pytest.fail(f"Generation report in wrong location: {file}")
```

#### Test 5: Canonical Structure Enforced
```python
def test_canonical_structure_enforced():
    """Validate docs/ matches canonical-docs-structure.yaml"""
    canonical = load_yaml("cortex-brain/canonical-docs-structure.yaml")
    actual = scan_docs_directory()
    
    validate_structure(canonical, actual)
```

**Output:** Test suite with 100% coverage of drift scenarios

---

### Phase 6: Documentation & Guardrails (30 min)

**Goal:** Document canonical structure and create safeguards

**Deliverables:**

#### 1. Canonical Structure Definition
**File:** `cortex-brain/canonical-docs-structure.yaml`

```yaml
version: 1.0.0
last_updated: 2025-11-18
description: Canonical documentation structure managed by Enterprise Documentation Orchestrator

# Files that MUST be generated (owned by orchestrator)
generated_files:
  - path: docs/index.md
    generator: MkdocsGenerator
    marker: "<!-- AUTO-GENERATED by MkdocsGenerator -->"
  
  - path: docs/EXECUTIVE-SUMMARY.md
    generator: ExecutiveSummaryGenerator
    marker: "<!-- AUTO-GENERATED by ExecutiveSummaryGenerator -->"
  
  - path: docs/FEATURES.md
    generator: FeatureListGenerator
    marker: "<!-- AUTO-GENERATED by FeatureListGenerator -->"

# Directories allowed in docs/
allowed_directories:
  - docs/diagrams/        # Generated Mermaid diagrams
  - docs/assets/          # Static assets (images, icons)
  - docs/images/          # Documentation images
  - docs/stylesheets/     # CSS files
  - docs/overrides/       # MkDocs theme overrides

# Forbidden patterns (will fail tests)
forbidden_patterns:
  - "docs/**/*-REPORT-*.md"  # Reports belong in cortex-brain/documents/reports/
  - "docs/**/*.backup"        # Backup files
  - "docs/**/*.html"          # Test files
  - "docs/**/manual-*.md"     # Manual docs belong in cortex-brain/documents/

# Static assets (never deleted)
static_assets:
  - docs/assets/
  - docs/images/
  - docs/stylesheets/
  - docs/overrides/
```

#### 2. Documentation Guide
**File:** `cortex-brain/documents/guides/DOCUMENTATION-CONTRIBUTION-GUIDE.md`

Content: How to add documentation properly (use generators, not manual files)

#### 3. Pre-commit Hook
**File:** `.git/hooks/pre-commit`

```bash
#!/bin/bash
# CORTEX Documentation Integrity Check
python3 scripts/validate_docs_structure.py --strict
```

---

## üìã Execution Checklist

### Pre-Execution
- [ ] Review cleanup manifest
- [ ] Confirm no critical files in deletion list
- [ ] Backup entire `docs/` folder
- [ ] Create rollback script

### Execution
- [ ] Phase 1: Discovery & Verification ‚úÖ
- [ ] Phase 2: Safe Migration ‚úÖ
- [ ] Phase 3: Cleanup Execution ‚úÖ
- [ ] Phase 4: Generator Enhancement ‚úÖ
- [ ] Phase 5: Validation Tests ‚úÖ
- [ ] Phase 6: Documentation & Guardrails ‚úÖ

### Post-Execution
- [ ] Run full test suite
- [ ] Verify MkDocs site builds
- [ ] Regenerate all documentation
- [ ] Commit canonical structure files
- [ ] Update CORTEX documentation

---

## üö® Risks & Mitigation

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Accidentally delete critical file | High | Low | Full backup + dry run + manifest review |
| Break MkDocs build | Medium | Low | Test build after each phase |
| Lose manual content permanently | Medium | Low | Archive before deletion |
| Tests too strict (false positives) | Low | Medium | Gradual test rollout, adjust thresholds |
| Generator markers missing | Low | Medium | Phase 4 adds markers, Phase 5 validates |

---

## üìä Success Criteria

- ‚úÖ Zero manual files in `docs/` directory
- ‚úÖ All generated files have `<!-- AUTO-GENERATED -->` marker
- ‚úÖ MkDocs site builds successfully
- ‚úÖ All validation tests pass (100%)
- ‚úÖ Canonical structure documented and enforced
- ‚úÖ No drift detected after 30 days

---

## üîÑ Ongoing Maintenance

### Weekly
- Run validation tests in CI/CD pipeline
- Review test failures (if any)
- Update canonical structure if generators change

### Monthly
- Audit `docs/` for drift
- Review archived manual files (if still needed)
- Update validation tests for new patterns

### Quarterly
- Review generator coverage (are all docs automated?)
- Optimize generator performance
- Consider new documentation needs

---

## üìù Implementation Notes

### Tools & Scripts

**1. Discovery Script**
```bash
python scripts/docs_cleanup_discovery.py \
  --output cortex-brain/cleanup-reports/cleanup-manifest-2025-11-18.json
```

**2. Migration Script**
```bash
python scripts/docs_cleanup_migrate.py \
  --manifest cortex-brain/cleanup-reports/cleanup-manifest-2025-11-18.json \
  --dry-run
```

**3. Cleanup Script**
```bash
python scripts/docs_cleanup_execute.py \
  --manifest cortex-brain/cleanup-reports/cleanup-manifest-2025-11-18.json \
  --backup cortex-brain/archives/docs-backup-2025-11-18/ \
  --confirm
```

**4. Validation Script**
```bash
python scripts/validate_docs_structure.py \
  --canonical cortex-brain/canonical-docs-structure.yaml \
  --strict
```

---

## üéØ Next Steps

Ready to execute cleanup plan. Choose your approach:

### Option A: Full Automated Pipeline
Run all 6 phases sequentially with confirmation prompts.

### Option B: Phase-by-Phase Manual
Execute each phase individually with manual review.

### Option C: Dry Run First
Run discovery + migration in dry-run mode to preview changes.

Which approach would you like to take?

---

**Author:** Asif Hussain  
**Copyright:** ¬© 2024-2025 Asif Hussain. All rights reserved.  
**Status:** Planning Complete - Ready for Execution  
**Estimated Time:** 4-5 hours for full cleanup + tests
