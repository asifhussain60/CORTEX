# CORTEX Development Executor - Clean Code Gates
# Enforces code quality standards during development workflow
# Author: Asif Hussain | Â© 2024-2025

version: "1.0.0"
component: "development-executor"
gate_type: "clean-code"
enforcement_level: "blocking"  # Blocks commits/merges when violations detected

# PyLint Configuration - Unused Code Detection
pylint:
  enabled: true
  enforcement: "blocking"
  
  checks:
    unused_imports:
      enabled: true
      severity: "error"
      message: "Unused import detected. Remove to keep code clean."
      rationale: "Unused imports clutter codebase and increase load time"
      
    unused_variables:
      enabled: true
      severity: "error"
      message: "Unused variable detected. Remove or prefix with underscore if intentionally unused."
      rationale: "Unused variables indicate dead code or incomplete refactoring"
      
    unused_functions:
      enabled: true
      severity: "error"
      message: "Unused function detected. Remove or document if part of public API."
      rationale: "Unused functions accumulate technical debt"
      
    unused_arguments:
      enabled: true
      severity: "warning"  # Warning not blocking - may be interface requirements
      message: "Unused argument detected. Consider removing or prefixing with underscore."
      rationale: "Unused arguments may indicate interface mismatch"
  
  configuration:
    disable_checks:
      - "C0103"  # Invalid name (allow non-PEP8 names for compatibility)
      - "C0114"  # Missing module docstring (not all modules need docstrings)
    
    max_line_length: 120
    good_names: ["i", "j", "k", "x", "y", "z", "id", "db", "pk"]
  
  commands:
    check: "pylint --rcfile=.pylintrc src/"
    fix: "autopep8 --in-place --recursive src/"

# Radon Configuration - Cyclomatic Complexity
radon:
  enabled: true
  enforcement: "warning"  # Warns but doesn't block - allows conscious complexity decisions
  
  complexity_thresholds:
    simple:
      max_complexity: 5
      description: "Simple functions with linear flow"
      enforcement: "strict"
      
    medium:
      max_complexity: 8
      description: "Moderate complexity with conditional logic"
      enforcement: "strict"
      
    complex:
      max_complexity: 10
      description: "Complex functions requiring careful review"
      enforcement: "strict"
      warning: "Consider refactoring if complexity exceeds this threshold"
      
    very_complex:
      max_complexity: 15
      description: "Very complex - requires justification"
      enforcement: "blocking"
      error: "Complexity too high. Refactor required before merge."
  
  configuration:
    show_complexity: true
    show_mi: true  # Maintainability Index
    min_mi_threshold: 20  # Minimum maintainability index (0-100 scale)
    
  commands:
    check: "radon cc src/ -a -nb"
    check_mi: "radon mi src/ -nb"
    check_raw: "radon raw src/ -s"

# Commented Code Detection
commented_code:
  enabled: true
  enforcement: "blocking"
  
  detection:
    patterns:
      # Python single-line comments
      - pattern: '^\s*#\s*(def|class|if|for|while|return|import)'
        language: "python"
        severity: "error"
        
      # Python multi-line comments
      - pattern: '^\s*"""\s*(def|class|if|for|while)'
        language: "python"
        severity: "error"
        
      # C# commented code
      - pattern: '^\s*//\s*(public|private|protected|class|if|for|return)'
        language: "csharp"
        severity: "error"
  
  exceptions:
    # Allow example code in docstrings
    - context: "docstring"
      pattern: '>>> '
      
    # Allow TODO comments with code context
    - context: "todo"
      pattern: '# TODO:'
  
  configuration:
    max_consecutive_commented_lines: 3
    message: "Commented code detected. Remove dead code or use version control for history."
    rationale: "Commented code creates confusion and reduces readability. Use git history instead."
    
  commands:
    detect: "python scripts/detect_commented_code.py src/"

# Dead Code Detection (Functions/Classes never called)
dead_code:
  enabled: true
  enforcement: "warning"  # Warning only - may be part of public API
  
  detection_strategy:
    - "Static analysis to find unreferenced functions/classes"
    - "Exclude public API methods (defined in __all__ or documented)"
    - "Exclude test fixtures and helper functions"
  
  exclusions:
    - "__init__.py:__all__"  # Explicitly exported
    - "tests/**/*"  # Test helpers
    - "**/base_*.py"  # Base classes
    - "**/abstract_*.py"  # Abstract classes
  
  commands:
    detect: "vulture src/ --min-confidence 80"

# Code Duplication Detection
duplication:
  enabled: true
  enforcement: "warning"
  
  thresholds:
    min_duplicate_lines: 6  # Minimum lines to flag as duplication
    min_duplicate_tokens: 50  # Minimum tokens for semantic duplication
  
  configuration:
    ignore_imports: true
    ignore_comments: true
    ignore_whitespace: true
  
  commands:
    detect: "python -m pylint --disable=all --enable=duplicate-code src/"

# Import Order Validation (PEP 8)
import_order:
  enabled: true
  enforcement: "warning"
  
  order:
    - "Standard library imports"
    - "Related third party imports"
    - "Local application/library specific imports"
  
  configuration:
    group_by_package: true
    sort_imports: true
    
  commands:
    check: "isort --check-only --diff src/"
    fix: "isort src/"

# Naming Conventions (PEP 8)
naming_conventions:
  enabled: true
  enforcement: "warning"
  
  rules:
    classes: "CamelCase"
    functions: "snake_case"
    constants: "UPPER_SNAKE_CASE"
    variables: "snake_case"
    private: "_leading_underscore"
  
  exceptions:
    - "Django model classes (allow Meta inner class)"
    - "Test classes (allow Test prefix)"
    - "Type variables (allow single uppercase letter: T, K, V)"

# Documentation Coverage
documentation:
  enabled: true
  enforcement: "warning"
  
  requirements:
    public_functions: true
    public_classes: true
    public_methods: true
    modules: false  # Not all modules need docstrings
  
  docstring_style: "google"  # Google, NumPy, or Sphinx
  
  commands:
    check: "pydocstyle src/ --convention=google"

# Type Hint Coverage
type_hints:
  enabled: true
  enforcement: "warning"
  
  requirements:
    function_signatures: true
    function_returns: true
    class_attributes: false  # Optional for now
  
  commands:
    check: "mypy src/ --strict"

# Integration with Pre-Commit Hooks
pre_commit:
  enabled: true
  hooks:
    - id: "pylint"
      stages: ["commit"]
      pass_filenames: true
      
    - id: "radon-complexity"
      stages: ["commit"]
      pass_filenames: true
      
    - id: "detect-commented-code"
      stages: ["commit"]
      pass_filenames: true
      
    - id: "isort"
      stages: ["commit"]
      pass_filenames: true
      auto_fix: true  # Auto-fix import order

# Enforcement Rules
enforcement:
  blocking_violations:
    - "unused_imports"
    - "unused_variables"
    - "unused_functions"
    - "commented_code"
    - "complexity > 15"
  
  warning_violations:
    - "unused_arguments"
    - "complexity 10-15"
    - "dead_code"
    - "code_duplication"
    - "naming_conventions"
    - "missing_docstrings"
    - "missing_type_hints"
  
  auto_fix_enabled:
    - "import_order"
    - "code_formatting"

# Quality Metrics Dashboard
metrics:
  track:
    - "pylint_score"
    - "average_complexity"
    - "maintainability_index"
    - "code_duplication_percentage"
    - "type_hint_coverage"
    - "docstring_coverage"
  
  targets:
    pylint_score: ">= 9.0"
    average_complexity: "<= 5.0"
    maintainability_index: ">= 70"
    code_duplication: "<= 5%"
    type_hint_coverage: ">= 80%"
    docstring_coverage: ">= 70%"

# CI/CD Integration
cicd:
  gate_name: "Clean Code Quality Gate"
  
  checks:
    - name: "PyLint Score"
      command: "pylint src/ --score=y"
      threshold: ">= 9.0"
      blocking: true
      
    - name: "Cyclomatic Complexity"
      command: "radon cc src/ -a -nb"
      threshold: "average <= 5.0"
      blocking: false
      
    - name: "Commented Code"
      command: "python scripts/detect_commented_code.py src/"
      threshold: "0 violations"
      blocking: true
  
  reports:
    format: "json"
    output_path: "reports/clean-code-report.json"
    upload_to_dashboard: true

# Developer Guidance
developer_guidance:
  on_violation:
    unused_imports: |
      Remove the unused import. If it's part of a public API, 
      add it to __all__ to explicitly mark it as exported.
    
    unused_variables: |
      Remove the variable if truly unused. If it's intentionally 
      unused (e.g., unpacking), prefix with underscore: _unused
    
    high_complexity: |
      Refactor the function into smaller, focused functions. 
      Consider extracting complex conditionals into named functions 
      that describe what they check.
    
    commented_code: |
      Delete commented code - use git history if you need to 
      reference old implementations. If it's example code, 
      move it to docstrings with >>> markers.
  
  best_practices:
    - "Keep functions under 50 lines"
    - "Keep complexity under 5 for simple functions"
    - "Use meaningful variable names (no single letters except loops)"
    - "Document why, not what (code should be self-documenting)"
    - "Prefer composition over inheritance"
    - "Follow single responsibility principle"

# References
references:
  pylint_docs: "https://pylint.pycqa.org/en/latest/"
  radon_docs: "https://radon.readthedocs.io/en/latest/"
  pep8: "https://pep8.org/"
  clean_code: "Clean Code by Robert C. Martin"
