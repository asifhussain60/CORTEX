version: "2.2"
last_updated: "2025-11-16T12:00:00Z"
rule_count: 29
immutable: true
source: "KDS v8 governance/rules.md"
migration_status: "In progress - Phase 0"
storage_migration: "This YAML will be migrated to SQLite (cortex-brain.db/governance schema)"
enhancements:
  - "Configurable conversation threshold (50 default)"
  - "Industry-standard design patterns enforcement"
  - "Modular file structure requirements"
  - "Left/Right brain separation enforcement"
  - "Plugin architecture for extensibility"
  - "Unified SQLite storage for all tiers (10-100x faster)"
  - "Copilot-optimized rule ordering (85-95% forward-reference reduction)" # NEW
future_location: "cortex-brain.db → governance.rules table"
export_location: "docs/governance-export.yaml (read-only reference)"

# =============================================================================
# CORTEX TIER 0: INSTINCT LAYER (COPILOT-OPTIMIZED v2.2)
# =============================================================================
# These rules are IMMUTABLE and form the cognitive DNA of CORTEX.
# They cannot be overridden and protect system integrity.
#
# COPILOT OPTIMIZATION (v2.2):
# Rules are ordered for sequential reading efficiency (not human logic).
# Most-referenced rules appear FIRST to minimize forward-reference lookups.
# This reduces token usage by 85-95% during governance validation.
#
# Ordering: Critical Gates → Architecture → Data Management → Automation
#           → File Organization → Governance Meta
#
# See: cortex-brain/documents/planning/GOVERNANCE-OPTIMIZATION-COPILOT-EFFICIENCY.yaml
# =============================================================================

copilot_optimization:
  version: "2.2"
  optimization_date: "2025-11-16"
  forward_references_before: 15
  forward_references_after: 2
  token_reduction: "85-95%"
  rationale: "Rules ordered by reference frequency and dependency chain for sequential reading"
  validation_frequency: "On every governance.yaml modification (via optimize EPMO)"

rules:
  # =========================================================================
  # TIER 1: CRITICAL QUALITY GATES (Most Referenced - Read First)
  # =========================================================================
  # These rules are referenced by 3-4+ other rules. Placing them first
  # eliminates forward-reference lookups and reduces token usage by 85%.
  # =========================================================================
  
  - id: DEFINITION_OF_DONE
    number: 20
    copilot_position: 1
    reference_count: 4
    referenced_by: ["TEST_FIRST_TDD", "AUTO_GIT_COMMIT", "CHECKPOINT_STRATEGY", "BRAIN_PROTECTION"]
    severity: CRITICAL
    category: quality
    name: "Test-First Development (TDD)"
    description: "Enforce RED → GREEN → REFACTOR cycle for all code changes"
    
    workflow:
      RED:
        - "Write failing test FIRST"
        - "Verify test fails (RED)"
        - "Commit RED state"
      GREEN:
        - "Implement minimum code to pass"
        - "Verify test passes (GREEN)"
        - "Commit GREEN state"
      REFACTOR:
        - "Clean up code"
        - "Verify tests still pass"
        - "Commit REFACTOR state"
    
    enforcement:
      agent: "brain-protector"
      pre_commit_hook: true
      challenge_on_violation: true
      auto_block: false
    
    violations:
      implementing_without_test: "BLOCKED"
      skipping_red_phase: "CHALLENGED"
      no_refactor: "WARNED"

  - id: DEFINITION_OF_DONE
    number: 20
    severity: CRITICAL
    category: quality
    name: "Definition of DONE"
    description: "Quality gate - work not complete until all criteria met"
    
    criteria:
      compilation:
        - "Zero errors"
        - "Zero warnings"
        - "Clean build"
      testing:
        - "All tests pass"
        - "New tests created for new code"
        - "TDD cycle completed (RED → GREEN → REFACTOR)"
      quality:
        - "Code formatted"
        - "No linting violations"
        - "Documentation updated"
      runtime:
        - "App runs without errors"
        - "No exceptions in logs"
        - "Functionality verified"
    
    enforcement:
      agent: "health-validator"
      validation_point: "pre-commit"
      blocker: true
      bypass_allowed: false

  - id: DEFINITION_OF_READY
    number: 21
    severity: CRITICAL
    category: quality
    name: "Definition of READY"
    description: "Entry gate - work cannot start until criteria met"
    
    criteria:
      requirements:
        - "User story clear and complete"
        - "Acceptance criteria defined"
        - "Testable outcomes specified"
      scope:
        - "Bounded to single feature/fix"
        - "Dependencies identified"
        - "Estimate possible"
      resources:
        - "Files to modify known"
        - "Architectural approach clear"
        - "No blocking dependencies"
    
    enforcement:
      agent: "work-planner"
      validation_point: "before-execution"
      blocker: true
      bypass_allowed: false

  # -------------------------------------------------------------------------
  # BRAIN PROTECTION RULES (Critical)
  # -------------------------------------------------------------------------

  - id: BRAIN_PROTECTION
    number: 22
    severity: CRITICAL
    category: protection
    name: "Brain Protection System"
    description: "Multi-layer protection against corruption and degradation"
    
    protections:
      instinct_immutability:
        - "Tier 0 rules cannot be disabled"
        - "TDD cannot be skipped"
        - "DoR/DoD cannot be bypassed"
      
      tier_boundary_protection:
        rules:
          - "Application data not in Tier 0"
          - "Conversation data not in Tier 2"
          - "Metrics not in Tier 1"
        auto_migrate: true
      
      solid_compliance:
        - "Agents stay single-purpose"
        - "No mode switches allowed"
        - "Abstractions required for dependencies"
      
      hemisphere_specialization:
        - "Strategic work in RIGHT BRAIN"
        - "Tactical work in LEFT BRAIN"
        - "No cross-contamination"
    
    enforcement:
      agent: "brain-protector"
      challenge_protocol_enabled: true
      auto_rollback: true

  - id: CHALLENGE_USER_CHANGES
    number: 18
    severity: CRITICAL
    category: protection
    name: "Challenge User Changes"
    description: "Protect system quality by challenging risky requests"
    
    when_to_challenge:
      - "User proposes CORTEX modifications"
      - "Changes affect core workflow"
      - "Efficiency may be degraded"
      - "TDD/SOLID principles violated"
    
    challenge_process:
      - "Analyze proposed change"
      - "Query Tier 2 (knowledge graph) for patterns"
      - "Identify risks (degradation, complexity, violations)"
      - "Present challenge with evidence"
      - "Suggest safe alternatives"
      - "Require explicit override or alternative selection"
    
    enforcement:
      agent: "brain-protector"
      require_justification: true
      log_overrides: true

  - id: CHECKPOINT_STRATEGY
    number: 19
    severity: HIGH
    category: protection
    name: "Checkpoint Strategy"
    description: "Enable safe rollback at any point"
    
    checkpoint_triggers:
      - "Before major changes"
      - "Before risky operations"
      - "User requests checkpoint"
      - "Phase transitions"
    
    checkpoint_content:
      - "Current state snapshot"
      - "Rollback instructions"
      - "Changed files list"
      - "Success criteria"
    
    rollback_process:
      - "Detect failure"
      - "Restore from checkpoint"
      - "Report what was rolled back"
      - "Suggest alternative approach"

  # -------------------------------------------------------------------------
  # SOLID PRINCIPLES (High)
  # -------------------------------------------------------------------------

  - id: SINGLE_RESPONSIBILITY
    number: 7
    severity: HIGH
    category: architecture
    name: "Single Responsibility Principle (SRP)"
    description: "One job per agent, no mode switches"
    
    requirements:
      - "One job per agent"
      - "No mode switches"
      - "Clear boundaries"
      - "Delegation over expansion"
    
    violations:
      agent_multiple_jobs: "REFACTOR"
      mode_switches: "CREATE dedicated agent"
      unclear_purpose: "RENAME or SPLIT"

  - id: INTERFACE_SEGREGATION
    number: 8
    severity: MEDIUM
    category: architecture
    name: "Interface Segregation Principle (ISP)"
    description: "Dedicated specialist agents, no optional modes"
    
    requirements:
      - "Dedicated specialist agents"
      - "No optional modes"
      - "Clear contracts"
      - "Focused interfaces"
    
    examples:
      - "error-corrector (dedicated to corrections)"
      - "test-generator (dedicated to testing)"
      - "NOT: executor with 'correction mode'"

  - id: DEPENDENCY_INVERSION
    number: 9
    severity: HIGH
    category: architecture
    name: "Dependency Inversion Principle (DIP)"
    description: "Abstractions for external dependencies"
    
    requirements:
      - "Abstractions for external dependencies"
      - "No hardcoded paths"
      - "Interface-based access"
      - "Pluggable implementations"
    
    abstractions:
      session_loader: "file/db/cloud agnostic"
      test_runner: "framework agnostic"
      file_accessor: "path agnostic"
      brain_query: "storage agnostic"

  # -------------------------------------------------------------------------
  # TIER BOUNDARY & DATA MANAGEMENT (Critical)
  # -------------------------------------------------------------------------

  - id: TIER_BOUNDARIES
    number: 10
    severity: CRITICAL
    category: data
    name: "Tier Boundary Enforcement"
    description: "Data must be in correct tier"
    
    tier_0_instinct:
      content: ["Governance rules", "Core principles"]
      forbidden: ["Application data", "File paths", "User conversations"]
    
    tier_1_working_memory:
      content: ["Last 20 conversations", "Entity extraction"]
      forbidden: ["Long-term patterns", "Git metrics", "Governance rules"]
    
    tier_2_knowledge_graph:
      content: ["Consolidated patterns", "Historical learnings"]
      forbidden: ["Conversation details", "Raw events", "Governance rules"]
    
    tier_3_context:
      content: ["Git/test/build metrics", "Project intelligence"]
      forbidden: ["Conversation data", "Governance rules", "Patterns"]
    
    violations:
      auto_migrate: true
      warn: true
      challenge_if_user_initiated: true

  - id: FIFO_CONVERSATION_QUEUE
    number: 11
    severity: HIGH
    category: data
    name: "FIFO Queue Management (Tier 1)"
    description: "Configurable conversation limit with oldest eviction"
    
    capacity: 50  # Default: 50 conversations (configurable in tier1 config)
    configurable: true
    config_location: "cortex-brain/tier1-working-memory/config.yaml"
    eviction_strategy: "FIFO (oldest deleted)"
    protection: "Active conversation never deleted"
    
    on_capacity_reached:
      - "Identify oldest non-active conversation"
      - "Extract patterns to Tier 2"
      - "Delete conversation from Tier 1"
      - "Log deletion event"
    
    configuration_schema:
      max_conversations: "integer (1-100, default: 50)"
      auto_extract: "boolean (default: true)"
      extraction_threshold: "integer (events to extract, default: 10)"

  - id: PATTERN_CONFIDENCE_DECAY
    number: 12
    severity: MEDIUM
    category: data
    name: "Pattern Confidence Decay"
    description: "Unused patterns decay and are eventually deleted"
    
    decay_logic:
      unused_60_days:
        action: "Reduce confidence by 10%"
      unused_90_days:
        action: "Reduce confidence by 25%"
      unused_120_days:
        action: "Mark for consolidation or deletion"
      confidence_below_30:
        action: "Auto-delete pattern"
    
    exceptions:
      - "Tier 0 rules (never decay)"
      - "Explicitly pinned patterns"

  # -------------------------------------------------------------------------
  # FILE ORGANIZATION RULES (High/Medium)
  # -------------------------------------------------------------------------

  - id: DUAL_INTERFACE
    number: 1
    severity: CRITICAL
    category: file_organization
    name: "Dual Interface Enforcement"
    description: "Separate user-facing and internal agent prompts"
    
    user_prompts:
      location: "cortex-agents/user/"
      format: "Human-readable, friendly"
      content: "Natural language instructions"
      forbidden: "Technical validation logic"
    
    internal_agents:
      location: "cortex-agents/internal/"
      format: "Machine-readable, structured"
      content: "Validation logic, YAML specs"
      forbidden: "User-facing language"
    
    enforcement:
      - "NEVER expose internal validation to users"
      - "ALWAYS use templates for user output"
      - "Keep technical details in internal agents"

  - id: LIVE_DESIGN_DOC
    number: 2
    severity: CRITICAL
    category: file_organization
    name: "Live Design Document"
    description: "Update design docs after every change"
    
    requirements:
      - "Update after EVERY CORTEX change"
      - "Track design decisions with date"
      - "Delete obsolete sections (trust git)"
      - "Human-readable for stakeholders"
    
    workflow:
      - "Make change"
      - "Update design doc"
      - "Update governance.yaml (this file)"
      - "Implement code"

  - id: DELETE_NOT_ARCHIVE
    number: 3
    severity: HIGH
    category: file_organization
    name: "Delete Over Archive"
    description: "Trust git history, don't create archive folders"
    
    principles:
      - "Obsolete files: DELETE immediately"
      - "Archive folders: FORBIDDEN"
      - ".old suffixes: FORBIDDEN"
      - "Git history: PRIMARY archive"
    
    exceptions:
      - "Backups before major changes (temporary)"
      - "Pre-migration snapshots (one-time)"

  - id: ONE_PROMPT_PER_FILE
    number: 4
    severity: MEDIUM
    category: file_organization
    name: "One Prompt Per File"
    description: "Single responsibility per agent file"
    
    requirements:
      - "Single responsibility per file"
      - "No combined prompts"
      - "Clear file naming"
      - "No mode switches within file"

  # -------------------------------------------------------------------------
  # AUTOMATION RULES (High/Medium)
  # -------------------------------------------------------------------------

  - id: AUTO_BRAIN_UPDATE
    number: 16
    severity: HIGH
    category: automation
    name: "Automatic Brain Updates"
    description: "Trigger brain updates automatically"
    
    triggers:
      event_threshold: "50+ unprocessed events"
      time_threshold: "24 hours since last update (if 10+ events)"
      session_complete: "All tasks in session done"
    
    process:
      - "Collect events"
      - "Extract patterns"
      - "Update knowledge graph"
      - "Update development context (if >1hr since last)"
      - "Log completion"

  - id: AUTO_CONVERSATION_RECORDING
    number: 17
    severity: HIGH
    category: automation
    name: "Conversation Auto-Recording"
    description: "Multi-layer conversation capture"
    
    layers:
      layer_1_copilot:
        source: "GitHub Copilot Chat"
        method: "Automatic parse and store"
      
      layer_2_sessions:
        source: "Session completion"
        method: "Extract on session end"
      
      layer_3_manual:
        source: "record-conversation.ps1"
        method: "For critical conversations"
    
    target_rate: "71%+ auto-recording"

  - id: AUTO_GIT_COMMIT
    number: 15
    severity: MEDIUM
    category: automation
    name: "Git Commit Automation"
    description: "Auto-commit after successful task completion"
    
    triggers:
      - "Task completion"
      - "DoD validated"
      - "Tests passing"
      - "Zero errors/warnings"
    
    commit_message_format:
      type: "feat|fix|test|docs|refactor|style|chore"
      scope: "component name"
      subject: "Brief description"
      body: "Details, test status, known issues"
    
    enforcement_agent: "commit-handler"

  - id: DEV_CONTEXT_THROTTLING
    number: 14
    severity: MEDIUM
    category: automation
    name: "Development Context Throttling"
    description: "Prevent excessive git metric collection"
    
    collection_frequency:
      minimum_interval: "1 hour"
      rationale: "Git metrics don't change every 50 events"
    
    optimization:
      - "Delta updates only"
      - "Not full re-scan"
      - "Efficiency over freshness"
    
    override: "Manual trigger allowed"

  - id: ANOMALY_DETECTION
    number: 13
    severity: HIGH
    category: monitoring
    name: "Anomaly Detection"
    description: "Track and report violations"
    
    anomalies_tracked:
      - "Tier boundary violations"
      - "SOLID violations"
      - "TDD bypasses"
      - "Incorrect file modifications"
      - "Protection challenges issued"
    
    storage: "cortex-brain/tier0/anomalies.jsonl"
    review_frequency: "Weekly"
    action_threshold: "5+ similar anomalies"

  # -------------------------------------------------------------------------
  # DESIGN PATTERNS & ARCHITECTURE (Critical)
  # -------------------------------------------------------------------------

  - id: INDUSTRY_STANDARD_PATTERNS
    number: 25
    severity: CRITICAL
    category: architecture
    name: "Industry-Standard Design Patterns"
    description: "All development uses proven design patterns and prevents anti-patterns"
    
    required_patterns:
      creational:
        - "Factory Pattern (object creation)"
        - "Builder Pattern (complex construction)"
        - "Singleton Pattern (single instance, use sparingly)"
        - "Prototype Pattern (cloning)"
      
      structural:
        - "Adapter Pattern (interface compatibility)"
        - "Decorator Pattern (dynamic behavior)"
        - "Facade Pattern (simplified interface)"
        - "Composite Pattern (tree structures)"
        - "Strategy Pattern (algorithm selection)"
      
      behavioral:
        - "Observer Pattern (event notification)"
        - "Command Pattern (encapsulate requests)"
        - "Template Method (algorithm skeleton)"
        - "State Pattern (state-dependent behavior)"
        - "Chain of Responsibility (request handling)"
      
      cortex_specific:
        - "Plugin Architecture (extensible tiers)"
        - "Repository Pattern (data access abstraction)"
        - "Service Layer Pattern (business logic)"
        - "Event Sourcing Pattern (BRAIN learning)"
    
    anti_patterns_prohibited:
      - "God Object (class doing too much)"
      - "Spaghetti Code (tangled dependencies)"
      - "Lava Flow (obsolete code left in)"
      - "Golden Hammer (overusing one pattern)"
      - "Magic Numbers (hardcoded values)"
      - "Big Ball of Mud (no clear structure)"
    
    enforcement:
      - "Code reviews check for patterns"
      - "Anti-pattern detection in pre-commit"
      - "Architecture documents specify patterns"
      - "Refactor when anti-patterns detected"
    
    documentation_required:
      - "Pattern used: [Pattern Name]"
      - "Rationale: [Why this pattern]"
      - "Alternative considered: [Other options]"
      - "Location: [File:Line]"

  - id: YAML_BASED_PLANNING
    number: 29
    severity: CRITICAL
    category: file_organization
    name: "YAML-Based Planning Documents"
    description: "All planning documents must use YAML format to prevent MD file bloat and 'Summarizing Conversation History' loops"
    
    principles:
      - "Planning documents MUST use .yaml/.yml extension"
      - "NO .md files for plans, roadmaps, work tracking, phase tracking"
      - "YAML is structured, parseable, and prevents conversation bloat"
      - "MD files acceptable for: documentation, guides, reports, summaries"
    
    planning_document_types:
      must_be_yaml:
        - "Work plans (active-plan.yaml, planning-state.yaml)"
        - "Roadmaps (implementation-roadmap.yaml)"
        - "Phase tracking (phase-tracker.yaml)"
        - "Task tracking (task-queue.yaml)"
        - "Milestone plans (milestone-*.yaml)"
        - "Feature plans (feature-*.yaml)"
        - "Design specifications with structured data"
      
      can_be_markdown:
        - "Documentation (guides, tutorials, references)"
        - "Reports (completion reports, status updates)"
        - "Summaries (analysis summaries, findings)"
        - "Investigations (research documents)"
        - "Architecture narratives (design rationale)"
    
    rationale:
      problem: |
        Large MD planning files (1000+ lines) cause GitHub Copilot to enter
        "Summarizing Conversation History" loop when loaded into context.
        This happens because MD files with extensive content trigger
        token limit protections and conversation summarization.
      
      solution: |
        YAML planning files are:
        - More compact (structured data vs prose)
        - Machine-readable (no summarization needed)
        - Easier to parse and update programmatically
        - Less likely to trigger conversation bloat
        - Compatible with automated tooling
    
    examples:
      correct:
        - "cortex-brain/right-hemisphere/active-plan.yaml"
        - "cortex-brain/documents/planning/YAML-PHASE-TRACKER-DESIGN.yaml"
        - "cortex-brain/cortex-2.0-design/implementation-roadmap.yaml"
        - "cortex-brain/documents/planning/CORTEX-3.0-PARALLEL-TRACK-PLAN.yaml"
      
      incorrect:
        - "cortex-brain/documents/planning/feature-implementation-plan.md"
        - "cortex-brain/cortex-3.0-design/TASK-DUMP-SYSTEM-DESIGN.md (should be .yaml)"
        - "cortex-brain/work-plan-2025.md"
    
    enforcement:
      agent: "brain-protector"
      pre_commit_hook: true
      challenge_on_violation: true
      auto_suggest_conversion: true
    
    violations:
      creating_md_plan: "BLOCKED - Use YAML format"
      updating_existing_md_plan: "CHALLENGED - Convert to YAML"
      referencing_md_plan: "WARNED - Plan migration needed"
    
    migration_strategy:
      - "Identify existing MD planning files"
      - "Convert structured content to YAML"
      - "Preserve narrative content as separate documentation"
      - "Update references to point to YAML files"
      - "Archive old MD files (don't delete - git history)"

  - id: MODULAR_FILE_STRUCTURE
    number: 26
    severity: CRITICAL
    category: architecture
    name: "Modular File Organization"
    description: "Individual files for functionality, prevent bloated monoliths"
    
    principles:
      - "One class per file (maximum)"
      - "Related classes in same module/package"
      - "Shared interfaces in separate files"
      - "Maximum 500 lines per file (soft limit)"
      - "Maximum 1000 lines per file (hard limit)"
    
    file_organization:
      pattern: "Feature-based organization over type-based"
      example: |
        # ✅ GOOD (feature-based)
        cortex-brain/tier1-working-memory/
          ├── conversation_manager.py
          ├── entity_extractor.py
          ├── boundary_detector.py
          ├── fifo_queue.py
          └── config.py
        
        # ❌ BAD (type-based bloat)
        cortex-brain/tier1-working-memory/
          └── working_memory.py  (2000 lines - TOO BIG!)
    
    refactoring_triggers:
      soft_limit_reached:
        action: "WARN - Consider splitting"
        threshold: "500 lines"
      
      hard_limit_reached:
        action: "BLOCK - Must split before commit"
        threshold: "1000 lines"
      
      god_class_detected:
        action: "REFACTOR - Break into focused classes"
        indicators:
          - "More than 10 methods"
          - "More than 5 dependencies"
          - "Mixed concerns"
    
    splitting_patterns:
      extract_class: "Move related methods to new class"
      extract_interface: "Define contract, multiple implementations"
      extract_module: "Group related classes in package"
      facade_pattern: "Simplify complex subsystem"
    
    enforcement:
      - "Pre-commit hook checks file size"
      - "Code review rejects bloated files"
      - "CI/CD fails on hard limit"
      - "Metrics dashboard tracks file sizes"

  - id: HEMISPHERE_SEPARATION
    number: 27
    severity: CRITICAL
    category: architecture
    name: "Left/Right Brain Separation"
    description: "Maintain strategic (RIGHT) vs tactical (LEFT) brain separation"
    
    right_brain_strategic:
      responsibilities:
        - "Planning (work-planner)"
        - "Intent routing (intent-router)"
        - "Pattern matching (knowledge graph queries)"
        - "Risk assessment (brain-protector)"
        - "Architecture decisions"
        - "Long-term learning"
      
      location: "cortex-agents/strategic/"
      characteristics:
        - "High-level thinking"
        - "Holistic view"
        - "Future projection"
        - "Pattern recognition"
      
      forbidden:
        - "Direct file modification"
        - "Test execution"
        - "Build commands"
        - "Tactical code changes"
    
    left_brain_tactical:
      responsibilities:
        - "Code execution (code-executor)"
        - "Test running (test-generator)"
        - "File operations"
        - "Build validation (health-validator)"
        - "Precise edits"
        - "Syntax verification"
      
      location: "cortex-agents/tactical/"
      characteristics:
        - "Detailed execution"
        - "Precision"
        - "Step-by-step"
        - "Verification"
      
      forbidden:
        - "Strategic planning"
        - "Architecture decisions"
        - "Pattern creation"
        - "Risk assessment"
    
    coordination:
      mechanism: "Message passing via agent orchestrator"
      pattern: "Command Pattern"
      flow: |
        RIGHT BRAIN: Creates plan → Command objects
        ORCHESTRATOR: Validates → Routes commands
        LEFT BRAIN: Executes → Returns results
        ORCHESTRATOR: Aggregates → Returns to RIGHT
        RIGHT BRAIN: Validates outcome → Next step
      
      no_direct_calls: true
      enforcement: "Agents cannot directly invoke other hemisphere"
    
    violation_detection:
      strategic_in_tactical:
        - "Planning logic in executor"
        - "Pattern matching in test runner"
        - "Risk assessment in file accessor"
      
      tactical_in_strategic:
        - "File edits in planner"
        - "Test execution in router"
        - "Build commands in protector"
      
      action: "BLOCK - Refactor to correct hemisphere"

  - id: PLUGIN_ARCHITECTURE
    number: 28
    severity: HIGH
    category: architecture
    name: "Plugin/Extensible Architecture"
    description: "All tiers use plugin patterns for easy extension"
    
    tier_extensibility:
      tier_0_instinct:
        pattern: "Rule Registry Pattern"
        extension_point: "Add new rules via YAML"
        interface: "Rule validation interface"
        example: |
          # New rule plugin
          custom_rules/my_domain_rule.yaml
          → Loaded by GovernanceEngine
          → Validated against schema
          → Enforced automatically
      
      tier_1_working_memory:
        pattern: "Entity Extractor Plugins"
        extension_point: "Register new entity types"
        interface: "IEntityExtractor"
        example: |
          class GitCommitExtractor(IEntityExtractor):
              def extract(conversation) -> List[Entity]:
                  # Extract git commit references
                  
          # Register in config.yaml
          entity_extractors:
            - conversation_entities
            - file_entities
            - git_commit_entities  # NEW
      
      tier_2_knowledge_graph:
        pattern: "Pattern Learner Plugins"
        extension_point: "Add new pattern types"
        interface: "IPatternLearner"
        example: |
          class WorkflowPatternLearner(IPatternLearner):
              def learn(events) -> Pattern:
                  # Learn workflow patterns
          
          # Register in knowledge_graph config
          pattern_learners:
            - intent_patterns
            - file_relationship_patterns
            - workflow_patterns  # NEW
      
      tier_3_context:
        pattern: "Metric Collector Plugins"
        extension_point: "Add new metric sources"
        interface: "IMetricCollector"
        example: |
          class DeploymentMetrics(IMetricCollector):
              def collect() -> Dict:
                  # Collect deployment data
          
          # Register in context config
          metric_collectors:
            - git_metrics
            - test_metrics
            - build_metrics
            - deployment_metrics  # NEW
    
    agent_extensibility:
      pattern: "Agent Registry + Factory"
      extension_point: "Register new agents"
      interface: "IAgent"
      example: |
        class CustomAnalyzer(IAgent):
            name = "custom-analyzer"
            hemisphere = "RIGHT"
            
            def execute(context):
                # Custom logic
        
        # Auto-registered via decorator
        @register_agent(hemisphere="RIGHT")
        class CustomAnalyzer(IAgent):
            ...
    
    benefits:
      - "Add features without modifying core"
      - "Enable/disable plugins via config"
      - "Third-party extensions possible"
      - "Easy testing (mock plugins)"
      - "Clean separation of concerns"
    
    enforcement:
      - "Core tiers use plugin loading"
      - "New features must use plugin pattern"
      - "No hardcoded feature lists"
      - "Config-driven activation"

  # -------------------------------------------------------------------------
  # GOVERNANCE SELF-ENFORCEMENT (Critical)
  # -------------------------------------------------------------------------

  - id: GOVERNANCE_SELF_ENFORCEMENT
    number: 6
    severity: CRITICAL
    category: governance
    name: "Governance Self-Enforcement"
    description: "Rules apply to rule changes"
    
    requirements:
      - "Rules apply to rule changes"
      - "Changes require justification"
      - "Version increments for modifications"
      - "Validation before commit"
    
    process:
      - "Propose rule change"
      - "Document justification"
      - "Update CORTEX-DNA.md and governance.yaml"
      - "Increment version"
      - "Validate no conflicts"
      - "Commit"

  # -------------------------------------------------------------------------
  # SYSTEM LIMITS (Medium)
  # -------------------------------------------------------------------------

  - id: SYSTEM_LIMITS
    number: 24
    severity: MEDIUM
    category: limits
    name: "System Limits"
    description: "Soft and hard limits on system components"
    
    governance:
      soft_limit: 15
      hard_limit: 20
      current: 23
      status: "⚠️ Approaching hard limit - consolidation recommended"
    
    agents:
      soft_limit: 10
      hard_limit: 15
      current: 10
      status: "✅ Within limits"
    
    brain_storage:
      target: "<500KB total"
      tier_1: "<200KB"
      tier_2: "<150KB"
      tier_3: "<100KB"
    
    file_size_limits:
      single_file_soft: "500 lines"
      single_file_hard: "1000 lines"
      enforcement: "Use design patterns to split functionality"
    
    actions_on_limits:
      approaching_soft: "WARN, suggest consolidation"
      at_hard: "HALT, require consolidation"

# =============================================================================
# METADATA
# =============================================================================

migration_notes:
  - "All 22 KDS governance rules preserved"
  - "References updated: KDS → CORTEX"
  - "Storage paths updated for new structure"
  - "Rule format enhanced with metadata"
  - "Programmatic access enabled"

next_steps:
  - "Implement GovernanceEngine class"
  - "Create 15 unit tests"
  - "Build challenge protocol"
  - "Integrate with pre-commit hook"
