operation_refresh_docs:
  name: "CORTEX Documentation Refresh"
  version: "1.0"
  created: "2025-11-07"
  status: "active"
  purpose: "Comprehensive documentation update workflow analyzing recent development changes"
  
  invocation:
    primary: "#file:prompts/user/refresh-docs.md"
    parameters:
      since: 
        type: "date"
        default: "auto-detect"
        example: "2025-11-01"
      depth:
        type: "string"
        options: ["quick", "standard", "full"]
        default: "standard"
      deploy:
        type: "boolean"
        default: false
      target_files:
        type: "array"
        options: ["story", "technical", "images", "history", "all"]
        default: ["all"]

  documentation_structure:
    files:
      story:
        path: "docs/story/CORTEX-STORY/Awakening Of CORTEX.md"
        content_ratio: "95% story, 5% concepts"
        style: "First person 'I', emotional arc, vision-focused"
        restrictions: 
          - "NO code blocks"
          - "NO technical stats" 
          - "NO low-level details"
          - "Examples in narrative only"
      
      technical:
        path: "docs/story/CORTEX-STORY/Technical-CORTEX.md"
        content_ratio: "100% technical"
        style: "Professional technical documentation"
        includes:
          - "Code examples"
          - "API documentation" 
          - "Performance metrics"
          - "Architecture specifications"
      
      images:
        path: "docs/story/CORTEX-STORY/Image-Prompts.md"
        style: "AI prompts with gothic cyberpunk technical aesthetic"
        mode: "append_only"
        based_on: "Technical-CORTEX.md content"
        
      history:
        path: "docs/project/History.md"
        style: "First person 'I', chronological"
        content: "Technical decisions, motivation, challenges, outcomes"

  workflow:
    phases:
      phase_1_git_analysis:
        name: "Git Analysis & Change Detection"
        steps:
          analyze_commits:
            git_commands:
              history: "git log --since=\"{since}\" --oneline --stat"
              changed_files: "git diff HEAD~10 --name-only"
              commit_messages: "git log --since=\"{since}\" --pretty=format:\"%h - %an, %ar : %s\""
            extract:
              - "new_files_created"
              - "modified_files_in_src"
              - "deleted_moved_files"
              - "feature_commits"
              - "test_file_changes"
              - "config_changes"
            
          identify_gaps:
            compare: "recent_changes vs documented_features"
            gap_types:
              story_missing: "Feature not in story narrative"
              technical_missing: "Feature lacks technical documentation"
              diagram_missing: "Feature needs visual representation"
            output_format: "yaml"
            
      phase_2_story_update:
        name: "Update Awakening Story"
        target_file: "docs/story/CORTEX-STORY/Awakening Of CORTEX.md"
        approach:
          - "Determine narrative chapter for feature"
          - "Generate first-person narrative"
          - "Insert contextually into existing story"
        style_requirements:
          voice: "first_person_i"
          tone: "visionary_and_emotional"
          technical_level: "high_level_concepts_only"
          restrictions: ["no_code", "no_stats", "no_low_level"]
          
      phase_3_technical_update:
        name: "Update Technical Documentation"
        target_file: "docs/story/CORTEX-STORY/Technical-CORTEX.md"
        approach:
          - "Determine technical section"
          - "Generate detailed technical content"
          - "Insert with proper structure"
        content_requirements:
          include_code: true
          include_metrics: true
          include_diagrams: true
          granularity: "detailed"
          
      phase_4_image_prompts:
        name: "Update Image Generation Prompts"
        target_file: "docs/story/CORTEX-STORY/Image-Prompts.md"
        mode: "append_only"
        conditions: "if needs_visualization(feature)"
        style: "gothic_cyberpunk_technical"
        based_on: "Technical-CORTEX.md content"
        
      phase_5_history_update:
        name: "Update Development History"
        target_file: "docs/project/History.md"
        format: "chronological_timeline"
        voice: "first_person_i"
        sections:
          - "technical_details"
          - "motivation"
          - "challenges"
          - "outcome"
          - "files_modified"
          
      phase_6_build_deploy:
        name: "Build and Deploy"
        steps:
          build: "mkdocs build"
          test: "mkdocs serve --dev-addr=127.0.0.1:8000"
          deploy: 
            condition: "if deploy=true"
            command: "mkdocs gh-deploy"

  templates:
    story_narrative:
      format: |
        ## Chapter {chapter_number}: {feature_name}
        
        I realized that {problem_statement}. This led me to implement {solution_overview}.
        
        {narrative_details}
        
        The result was {outcome_description}.
    
    technical_section:
      format: |
        ### {feature_name}
        
        **Purpose:** {purpose}
        **Implementation:** {implementation_details}
        **API:** {api_documentation}
        **Performance:** {performance_metrics}
        **Examples:** {code_examples}
    
    image_prompt:
      format: |
        ## {feature_name} - {diagram_type}
        
        **Prompt:** Create a {diagram_type} showing {feature_description}
        **Style:** Gothic cyberpunk technical aesthetic
        **Elements:** {visual_elements}
        **Output:** cortex-{feature-name}-{diagram-type}.png
        **Location:** docs/assets/images/
    
    history_entry:
      format: |
        ## {date} - {milestone_name}
        
        I implemented {description}.
        
        **Technical Details:**
        {technical_details}
        
        **Motivation:** {motivation}
        **Challenges:** {challenges}
        **Outcome:** {outcome}
        **Files Modified:** {file_list}

  gap_detection:
    algorithms:
      feature_analysis:
        scan_paths: ["CORTEX/src/", "tests/", "config/"]
        file_patterns: ["*.py", "*.yaml", "*.json"]
        commit_keywords: ["feat:", "fix:", "docs:", "test:", "refactor:"]
        
      documentation_scan:
        story_keywords: ["Chapter", "I implemented", "The result was"]
        technical_keywords: ["Purpose:", "API:", "Performance:"]
        image_keywords: ["Prompt:", "Style:", "Output:"]
        
    output_schema:
      type: "array"
      items:
        type: "gap"
        properties:
          type: ["story_missing", "technical_missing", "diagram_missing"]
          feature: "string"
          impact: ["high", "medium", "low"]
          files: "array"
          priority: "integer"

  error_handling:
    git_failures:
      no_commits: "Skip refresh - no changes detected"
      invalid_date: "Use default since date"
      permission_denied: "Check git repository permissions"
      
    file_failures:
      missing_target: "Create file with template"
      write_permission: "Check file permissions"
      invalid_format: "Validate YAML/markdown syntax"
      
    build_failures:
      mkdocs_error: "Check mkdocs.yml configuration"
      missing_images: "Generate placeholder images"
      broken_links: "Update link references"

  performance:
    targets:
      git_analysis: "<10s"
      gap_detection: "<30s"
      story_update: "<60s"
      technical_update: "<60s"
      build_process: "<120s"
      
    optimizations:
      parallel_processing: true
      cache_git_analysis: true
      incremental_builds: true
      
  validation:
    requirements:
      - "All story updates maintain narrative flow"
      - "Technical docs include working code examples"
      - "Image prompts are append-only"
      - "History maintains chronological order"
      - "Build succeeds without errors"
      
    tests:
      - "Markdown syntax validation"
      - "Link checking"
      - "Image reference validation"
      - "YAML schema compliance"
      - "Story narrative coherence"

  success_criteria:
    documentation_completeness: ">90%"
    build_success: true
    deploy_success: "if requested"
    narrative_quality: "maintains emotional arc"
    technical_accuracy: "all examples work"