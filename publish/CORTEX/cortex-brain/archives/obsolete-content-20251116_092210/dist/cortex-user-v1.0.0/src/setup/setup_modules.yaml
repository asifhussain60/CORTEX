# CORTEX Setup Modules Configuration
#
# Defines all available setup modules, their execution order, and dependencies.
# Uses SOLID principles - each module handles ONE responsibility.
#
# Structure:
#   modules:
#     - module_id: Unique identifier
#       name: Display name
#       description: What this module does
#       phase: PRE_VALIDATION | ENVIRONMENT | DEPENDENCIES | FEATURES | VALIDATION | POST_SETUP
#       priority: Order within phase (lower = earlier)
#       dependencies: [list of module_ids that must run first]
#       optional: true/false (can skip on failure?)
#       enabled_by_default: true/false
#       config: Module-specific configuration

# Phase ordering:
# 1. PRE_VALIDATION (10) - Validate environment before setup
# 2. ENVIRONMENT (20) - Platform detection and configuration
# 3. DEPENDENCIES (30) - Install and verify dependencies
# 4. FEATURES (40) - Activate optional features
# 5. VALIDATION (50) - Validate setup completed
# 6. POST_SETUP (60) - Final tasks

modules:
  # ============================================
  # Phase 1: PRE_VALIDATION
  # ============================================
  
  - module_id: project_validation
    name: Project Structure Validation
    description: Verify CORTEX project structure and required directories exist
    phase: PRE_VALIDATION
    priority: 10
    dependencies: []
    optional: false
    enabled_by_default: true
    config:
      required_directories:
        - cortex-brain
        - src
        - tests
        - docs
      required_files:
        - cortex.config.json
        - requirements.txt
        - pytest.ini
  
  # ============================================
  # Phase 2: ENVIRONMENT
  # ============================================
  
  - module_id: platform_detection
    name: Platform Detection & Configuration
    description: Detect current platform (Mac/Windows/Linux) and configure environment
    phase: ENVIRONMENT
    priority: 10
    dependencies: [project_validation]
    optional: false
    enabled_by_default: true
    config:
      detect_platform: true
      save_platform_state: true
      configure_paths: true
  
  - module_id: git_sync
    name: Git Repository Sync
    description: Pull latest code from remote repository
    phase: ENVIRONMENT
    priority: 20
    dependencies: [platform_detection]
    optional: true  # Can continue without git pull
    enabled_by_default: true
    config:
      pull_before_setup: true
      timeout_seconds: 120
  
  - module_id: virtual_environment
    name: Virtual Environment Setup
    description: Create or activate Python virtual environment
    phase: ENVIRONMENT
    priority: 30
    dependencies: [platform_detection]
    optional: false
    enabled_by_default: true
    config:
      venv_path: .venv
      python_version_min: "3.10"
      create_if_missing: true
  
  # ============================================
  # Phase 3: DEPENDENCIES
  # ============================================
  
  - module_id: python_dependencies
    name: Python Dependencies Installation
    description: Install required Python packages from requirements.txt
    phase: DEPENDENCIES
    priority: 10
    dependencies: [virtual_environment]
    optional: false
    enabled_by_default: true
    config:
      requirements_file: requirements.txt
      upgrade_pip: true
      install_dev_dependencies: true
      timeout_seconds: 300
  
  - module_id: optional_dependencies
    name: Optional Dependencies
    description: Install optional packages for enhanced features
    phase: DEPENDENCIES
    priority: 20
    dependencies: [python_dependencies]
    optional: true
    enabled_by_default: false
    config:
      packages:
        - pillow  # For Vision API image processing
        - opencv-python  # Advanced image analysis
        - playwright  # Browser automation
  
  # ============================================
  # Phase 4: FEATURES
  # ============================================
  
  - module_id: vision_api
    name: Vision API Activation
    description: Enable GitHub Copilot Vision API for screenshot analysis
    phase: FEATURES
    priority: 10
    dependencies: [python_dependencies]
    optional: true  # Optional feature
    enabled_by_default: false
    config:
      config_file: cortex.config.json
      config_path: vision_api.enabled
      max_tokens_per_image: 500
      cache_results: true
      requires_copilot: true
  
  - module_id: conversation_tracking
    name: Conversation Tracking Setup
    description: Configure automatic conversation tracking to CORTEX brain
    phase: FEATURES
    priority: 20
    dependencies: []
    optional: true
    enabled_by_default: false
    config:
      tracking_method: ambient_daemon  # ambient_daemon | powershell | cli
      auto_start: true
      config_file: cortex.config.json
  
  - module_id: brain_initialization
    name: Brain Database Initialization
    description: Initialize Tier 1, 2, 3 brain databases and knowledge graph
    phase: FEATURES
    priority: 30
    dependencies: [python_dependencies]
    optional: false
    enabled_by_default: true
    config:
      tier1_db: cortex-brain/conversation-history.db
      tier2_yaml: cortex-brain/knowledge-graph.yaml
      tier3_context: cortex-brain/development-context.yaml
      create_if_missing: true
      run_migrations: true
  
  - module_id: mkdocs_setup
    name: Documentation Site Setup
    description: Configure and build MkDocs documentation site
    phase: FEATURES
    priority: 40
    dependencies: [python_dependencies]
    optional: true
    enabled_by_default: false
    config:
      build_docs: false  # Only install, don't build
      serve_on_completion: false
  
  # ============================================
  # Phase 5: VALIDATION
  # ============================================
  
  - module_id: brain_tests
    name: Brain Tests Validation
    description: Run core brain tests to validate Tier 0, 1, 2, 3 functionality
    phase: VALIDATION
    priority: 10
    dependencies: [brain_initialization]
    optional: true
    enabled_by_default: true
    config:
      test_paths:
        - tests/tier0/test_brain_protector.py
        - tests/tier1/test_working_memory.py
        - tests/tier2/test_knowledge_graph.py
        - tests/tier3/test_context_intelligence.py
      max_failures: 5
      timeout_seconds: 300
  
  - module_id: tooling_verification
    name: Tooling Verification
    description: Verify required development tools are installed
    phase: VALIDATION
    priority: 20
    dependencies: [platform_detection]
    optional: true
    enabled_by_default: true
    config:
      required_tools:
        - git
        - python3  # or python on Windows
        - pytest
      optional_tools:
        - mkdocs
        - black
        - flake8
  
  # ============================================
  # Phase 6: POST_SETUP
  # ============================================
  
  - module_id: setup_completion
    name: Setup Completion
    description: Mark setup as complete and display next steps
    phase: POST_SETUP
    priority: 10
    dependencies: []
    optional: false
    enabled_by_default: true
    config:
      update_config: true
      display_next_steps: true
      create_summary_file: true
      summary_path: cortex-brain/.setup_complete.yaml

# Default execution profiles
profiles:
  minimal:
    description: Minimal setup - only required modules
    modules:
      - project_validation
      - platform_detection
      - virtual_environment
      - python_dependencies
      - brain_initialization
      - setup_completion
  
  standard:
    description: Standard setup - recommended for most users
    modules:
      - project_validation
      - platform_detection
      - git_sync
      - virtual_environment
      - python_dependencies
      - brain_initialization
      - brain_tests
      - tooling_verification
      - setup_completion
  
  full:
    description: Full setup - all modules including optional features
    modules:
      - project_validation
      - platform_detection
      - git_sync
      - virtual_environment
      - python_dependencies
      - optional_dependencies
      - vision_api
      - conversation_tracking
      - brain_initialization
      - mkdocs_setup
      - brain_tests
      - tooling_verification
      - setup_completion

# Default profile to use
default_profile: standard
