{
    "session_id": "20251103-kds-independence",
    "key": "KDS_INDEPENDENCE",
    "branch": "features/kds",
    "started_at": "2025-11-03T21:00:00Z",
    "last_updated": "2025-11-03T21:00:00Z",
    "status": "PLANNING",
    "correlation_id": "kds-ind-001",
    "feature": "Make KDS fully independent for DevProjects repository",
    "created_by": "GitHub Copilot",
    "context": {
        "background": "KDS currently contains Noor Canvas-specific references and hard-coded paths that prevent it from being a truly portable system",
        "goal": "Transform KDS into a fully independent, reusable AI orchestration framework that can be deployed to any project in 5 minutes",
        "success_criteria": [
            "Zero hard-coded absolute paths",
            "Zero application-specific knowledge in default BRAIN",
            "Configuration fully template-based",
            "Documentation uses generic examples",
            "Successfully tested on a different project",
            "Setup wizard completes in under 5 minutes"
        ],
        "estimated_total_hours": 18.5,
        "phases": 7,
        "total_tasks": 26
    },
    "phases": [
        {
            "phase_number": 0,
            "name": "Pre-Flight Analysis & Validation",
            "description": "Comprehensive audit of all KDS dependencies and creation of test fixtures",
            "estimated_hours": 2.5,
            "tasks": [
                {
                    "task_id": "0.1",
                    "description": "Create comprehensive dependency audit script",
                    "files": [
                        "KDS/scripts/audit/audit-dependencies.ps1"
                    ],
                    "tests": [
                        "Script finds all hard-coded paths",
                        "Script identifies application-specific content",
                        "Script generates detailed report"
                    ],
                    "acceptance_criteria": [
                        "Script scans all KDS files recursively",
                        "Identifies: absolute paths, NoorCanvas references, session-212, project-specific names",
                        "Generates JSON report with file locations and line numbers",
                        "Exit code 0 if no issues found, 1 if issues exist"
                    ],
                    "rules": [
                        "Rule #2 (Live Design Document)"
                    ],
                    "status": "not_started",
                    "estimated_hours": 1.0
                },
                {
                    "task_id": "0.2",
                    "description": "Create mock test project structure for validation",
                    "files": [
                        "KDS/tests/fixtures/mock-project/README.md",
                        "KDS/tests/fixtures/mock-project/package.json",
                        "KDS/tests/fixtures/mock-project/src/App.tsx"
                    ],
                    "tests": [
                        "Mock project has .NET structure",
                        "Mock project has React structure",
                        "Mock project can be used for KDS setup testing"
                    ],
                    "acceptance_criteria": [
                        "Create minimal .NET + React project structure",
                        "Include: solution file, package.json, tsconfig, basic components",
                        "No actual build required - just folder structure",
                        "README documents purpose and usage"
                    ],
                    "rules": [
                        "Rule #8 (Test-First)"
                    ],
                    "status": "not_started",
                    "estimated_hours": 0.5
                },
                {
                    "task_id": "0.3",
                    "description": "Document current state baseline metrics",
                    "files": [
                        "KDS/docs/baseline-metrics-20251103.md"
                    ],
                    "tests": [
                        "Baseline document exists",
                        "Contains: file count, dependency count, hard-coded path count",
                        "Can be compared against post-migration metrics"
                    ],
                    "acceptance_criteria": [
                        "Run audit script and capture results",
                        "Document: total files, scripts with paths, BRAIN entries, config files",
                        "Create comparison template for post-migration validation",
                        "Commit as historical record"
                    ],
                    "rules": [
                        "Rule #2"
                    ],
                    "status": "not_started",
                    "estimated_hours": 0.5
                },
                {
                    "task_id": "0.4",
                    "description": "Create rollback strategy and backup",
                    "files": [
                        "KDS/docs/ROLLBACK-STRATEGY.md",
                        "KDS/scripts/backup-kds.ps1"
                    ],
                    "tests": [
                        "Backup script creates complete KDS snapshot",
                        "Rollback strategy is documented",
                        "Restoration can be done in under 2 minutes"
                    ],
                    "acceptance_criteria": [
                        "Backup script creates timestamped ZIP of entire KDS folder",
                        "Rollback doc explains how to restore from backup",
                        "Test backup/restore on mock project",
                        "Include in .gitignore: KDS/backups/"
                    ],
                    "rules": [
                        "Rule #3 (Delete Over Archive)"
                    ],
                    "status": "not_started",
                    "estimated_hours": 0.5
                }
            ]
        },
        {
            "phase_number": 1,
            "name": "Dynamic Path Resolution Infrastructure",
            "description": "Create workspace detection and path resolution utilities",
            "estimated_hours": 3.0,
            "tasks": [
                {
                    "task_id": "1.1",
                    "description": "Create workspace resolver utility module",
                    "files": [
                        "KDS/scripts/lib/workspace-resolver.ps1"
                    ],
                    "tests": [
                        "Tests/Unit/WorkspaceResolver.tests.ps1"
                    ],
                    "acceptance_criteria": [
                        "Function: Get-WorkspaceRoot (finds git root or parent folder)",
                        "Function: Get-KdsRoot (returns absolute path to KDS folder)",
                        "Function: Resolve-RelativePath (converts relative to absolute)",
                        "Function: Test-PathExists (validates paths before use)",
                        "All functions work on Windows, macOS, Linux (PowerShell Core)",
                        "Zero hard-coded paths in the module itself",
                        "Comprehensive error handling with helpful messages"
                    ],
                    "rules": [
                        "Rule #8 (Test-First)",
                        "Rule #9 (Tooling Auto-Setup)"
                    ],
                    "status": "not_started",
                    "estimated_hours": 1.5
                },
                {
                    "task_id": "1.2",
                    "description": "Update all PowerShell scripts to use workspace resolver",
                    "files": [
                        "KDS/scripts/validate-kds-references.ps1",
                        "KDS/scripts/sensors/query-knowledge-graph.ps1",
                        "KDS/scripts/run-migration.ps1",
                        "KDS/scripts/fix-github-references.ps1",
                        "KDS/scripts/collect-development-context.ps1",
                        "All other scripts with hard-coded paths (42+ files)"
                    ],
                    "tests": [
                        "Each script runs successfully from different working directories",
                        "No absolute paths remain in any script",
                        "Audit script reports zero path violations"
                    ],
                    "acceptance_criteria": [
                        "Add: . (Join-Path $PSScriptRoot 'lib/workspace-resolver.ps1') to each script",
                        "Replace: $baseDir = 'D:\\...' with $baseDir = Get-WorkspaceRoot",
                        "Replace all hard-coded paths with dynamic resolution",
                        "Test each script from: KDS folder, project root, arbitrary folder",
                        "All scripts exit code 0 when run from any location"
                    ],
                    "rules": [
                        "Rule #16 Step 5 (KDS Verification)"
                    ],
                    "status": "not_started",
                    "estimated_hours": 1.5
                }
            ]
        },
        {
            "phase_number": 2,
            "name": "BRAIN Knowledge Abstraction",
            "description": "Separate generic patterns from application-specific knowledge",
            "estimated_hours": 3.5,
            "tasks": [
                {
                    "task_id": "2.1",
                    "description": "Create knowledge-graph template with generic patterns only",
                    "files": [
                        "KDS/kds-brain/knowledge-graph-template.yaml"
                    ],
                    "tests": [
                        "Template contains zero application-specific references",
                        "Template includes only universal intent patterns",
                        "Template is valid YAML with correct schema"
                    ],
                    "acceptance_criteria": [
                        "Extract generic intent patterns (e.g., 'I want to add' → PLAN)",
                        "Remove: HostControlPanel, session-212, SPA/NoorCanvas paths",
                        "Keep: Generic file relationship patterns (co-modification logic)",
                        "Include: Common mistakes (generic programming errors)",
                        "Add placeholder comments: {{PROJECT_SPECIFIC_PATTERNS_HERE}}",
                        "Validate YAML syntax and schema"
                    ],
                    "rules": [
                        "Rule #2 (Live Design Document)"
                    ],
                    "status": "not_started",
                    "estimated_hours": 1.0
                },
                {
                    "task_id": "2.2",
                    "description": "Create Noor Canvas integration package (optional import)",
                    "files": [
                        "KDS/integrations/noor-canvas/README.md",
                        "KDS/integrations/noor-canvas/knowledge-patterns.yaml",
                        "KDS/integrations/noor-canvas/test-data.yaml"
                    ],
                    "tests": [
                        "Integration package can be imported separately",
                        "Noor Canvas-specific patterns preserved",
                        "Import script merges patterns without conflicts"
                    ],
                    "acceptance_criteria": [
                        "Extract all Noor Canvas patterns from knowledge-graph.yaml",
                        "Create: intent patterns, file relationships, test data (session-212)",
                        "Document: How to import these patterns into new KDS installation",
                        "Create: KDS/scripts/import-integration.ps1 -Integration 'noor-canvas'",
                        "README explains when/why to use this integration"
                    ],
                    "rules": [
                        "Rule #10 (Single Source of Truth)"
                    ],
                    "status": "not_started",
                    "estimated_hours": 1.5
                },
                {
                    "task_id": "2.3",
                    "description": "Update BRAIN initialization to use template",
                    "files": [
                        "KDS/prompts/internal/brain-reset.md",
                        "KDS/scripts/initialize-brain.ps1"
                    ],
                    "tests": [
                        "Fresh KDS setup creates knowledge-graph.yaml from template",
                        "No application-specific content in fresh BRAIN",
                        "Integration import works correctly"
                    ],
                    "acceptance_criteria": [
                        "Add check: If knowledge-graph.yaml missing → copy from template",
                        "Update brain-reset.md to reference template",
                        "Add .gitignore entry: KDS/kds-brain/knowledge-graph.yaml (project-specific)",
                        "Keep template in git, generate actual file during setup",
                        "Test on mock project structure"
                    ],
                    "rules": [
                        "Rule #16 (Mandatory Post-Task)"
                    ],
                    "status": "not_started",
                    "estimated_hours": 1.0
                }
            ]
        },
        {
            "phase_number": 3,
            "name": "Configuration Templating System",
            "description": "Convert all config files to templates with variable substitution",
            "estimated_hours": 2.5,
            "tasks": [
                {
                    "task_id": "3.1",
                    "description": "Create configuration template engine",
                    "files": [
                        "KDS/scripts/lib/config-template-engine.ps1"
                    ],
                    "tests": [
                        "Tests/Unit/ConfigTemplateEngine.tests.ps1"
                    ],
                    "acceptance_criteria": [
                        "Function: Expand-ConfigTemplate -Template 'path' -Variables @{} -Output 'path'",
                        "Support variables: {{PROJECT_NAME}}, {{PROJECT_ROOT}}, {{BUILD_COMMAND}}, etc.",
                        "Validation: Check all variables are provided before expansion",
                        "Error handling: Clear error if variable missing",
                        "Support JSON, YAML, Markdown template files",
                        "Test with sample template containing all variable types"
                    ],
                    "rules": [
                        "Rule #8 (Test-First)"
                    ],
                    "status": "not_started",
                    "estimated_hours": 1.0
                },
                {
                    "task_id": "3.2",
                    "description": "Convert config files to templates",
                    "files": [
                        "KDS/tooling/kds.config.template.json",
                        "KDS/tooling/tooling-inventory.template.json",
                        "KDS/kds-dashboard.template.html",
                        "KDS/templates/playwright-orchestration-robust.ps1.template"
                    ],
                    "tests": [
                        "Templates contain variable placeholders",
                        "Original configs preserved as .example files",
                        "Template expansion produces valid config"
                    ],
                    "acceptance_criteria": [
                        "Rename: kds.config.json → kds.config.template.json",
                        "Replace: 'NOOR-CANVAS' → {{PROJECT_NAME}}",
                        "Replace: 'D:\\PROJECTS\\NOOR CANVAS' → {{PROJECT_ROOT}}",
                        "Replace: 'dotnet build SPA/NoorCanvas/...' → {{BUILD_COMMAND}}",
                        "Keep original as kds.config.example.json for reference",
                        "Add .gitignore: *.config.json (generated files)",
                        "Document all available template variables in README"
                    ],
                    "rules": [
                        "Rule #2 (Live Design Document)"
                    ],
                    "status": "not_started",
                    "estimated_hours": 1.0
                },
                {
                    "task_id": "3.3",
                    "description": "Add config files to .gitignore (project-specific)",
                    "files": [
                        "KDS/.gitignore"
                    ],
                    "tests": [
                        "Generated configs not tracked by git",
                        "Templates are tracked by git",
                        "New KDS installations don't inherit old configs"
                    ],
                    "acceptance_criteria": [
                        "Add to .gitignore:",
                        "  kds-brain/knowledge-graph.yaml",
                        "  tooling/*.json (not *.template.json)",
                        "  kds-dashboard.html (not .template.html)",
                        "  sessions/*.json (except templates)",
                        "Ensure templates ARE tracked",
                        "Test: git status shows no config files after generation"
                    ],
                    "rules": [
                        "Rule #3 (Delete Over Archive)"
                    ],
                    "status": "not_started",
                    "estimated_hours": 0.5
                }
            ]
        },
        {
            "phase_number": 4,
            "name": "Setup Wizard & Initialization",
            "description": "Create automated setup experience for new projects",
            "estimated_hours": 3.5,
            "tasks": [
                {
                    "task_id": "4.1",
                    "description": "Create interactive setup wizard",
                    "files": [
                        "KDS/setup.ps1"
                    ],
                    "tests": [
                        "Wizard completes in under 5 minutes",
                        "All required inputs are validated",
                        "Generated configs are correct"
                    ],
                    "acceptance_criteria": [
                        "Interactive prompts: Project name, framework, build command, test command",
                        "Auto-detect: Git root, project type (.NET/React/Python), existing package.json",
                        "Generate all config files from templates",
                        "Initialize BRAIN with template knowledge-graph",
                        "Create initial session state",
                        "Display success summary with next steps",
                        "Support --NonInteractive mode with parameters",
                        "Example: .\\setup.ps1 -ProjectName 'MyApp' -Framework 'React'"
                    ],
                    "rules": [
                        "Rule #9 (Tooling Auto-Setup)"
                    ],
                    "status": "not_started",
                    "estimated_hours": 2.0
                },
                {
                    "task_id": "4.2",
                    "description": "Create project type detection utility",
                    "files": [
                        "KDS/scripts/lib/project-detector.ps1"
                    ],
                    "tests": [
                        "Detects .NET projects (via .sln or .csproj)",
                        "Detects React projects (via package.json + React dependency)",
                        "Detects Python projects (via requirements.txt or setup.py)",
                        "Detects Next.js, Vue, Angular variants"
                    ],
                    "acceptance_criteria": [
                        "Function: Detect-ProjectType -Path '.'",
                        "Returns: @{Type='dotnet-blazor'; Confidence=0.95; Evidence=@{...}}",
                        "Scan for: Solution files, package.json, requirements.txt",
                        "Parse package.json for framework dependencies",
                        "Return multiple detected types with confidence scores",
                        "Suggest build/test commands based on detected type"
                    ],
                    "rules": [
                        "Rule #9"
                    ],
                    "status": "not_started",
                    "estimated_hours": 1.0
                },
                {
                    "task_id": "4.3",
                    "description": "Create validation script for setup completion",
                    "files": [
                        "KDS/scripts/validate-setup.ps1"
                    ],
                    "tests": [
                        "Validates all required configs exist",
                        "Validates BRAIN is initialized",
                        "Validates git hooks are installed"
                    ],
                    "acceptance_criteria": [
                        "Check: All config files generated from templates",
                        "Check: knowledge-graph.yaml exists and valid",
                        "Check: Git hooks are executable",
                        "Check: Workspace resolver works",
                        "Check: Can load session state",
                        "Exit code 0 if all checks pass, 1 otherwise",
                        "Display detailed success/failure report"
                    ],
                    "rules": [
                        "Rule #16 Step 5 (KDS Verification)"
                    ],
                    "status": "not_started",
                    "estimated_hours": 0.5
                }
            ]
        },
        {
            "phase_number": 5,
            "name": "Documentation Generalization",
            "description": "Replace all Noor Canvas examples with generic, reusable examples",
            "estimated_hours": 2.5,
            "tasks": [
                {
                    "task_id": "5.1",
                    "description": "Update KDS user documentation with generic examples",
                    "files": [
                        "KDS/prompts/user/kds.md",
                        "KDS/README.md",
                        "KDS/sessions/resumption-guide.md"
                    ],
                    "tests": [
                        "Zero references to Noor Canvas found",
                        "Zero references to session-212 found",
                        "Examples use {{PROJECT_NAME}} placeholders"
                    ],
                    "acceptance_criteria": [
                        "Replace: 'D:\\PROJECTS\\NOOR CANVAS' → '{PROJECT_ROOT}' or '~/my-project'",
                        "Replace: 'SPA/NoorCanvas' → 'src/MyApp' or '{APP_FOLDER}'",
                        "Replace: 'HostControlPanel' → 'UserDashboard' (generic component name)",
                        "Replace: 'session-212' → 'test-session-001' (generic)",
                        "Add note: 'Examples show generic structure. Your paths may differ.'",
                        "Update Playwright examples to use generic selectors"
                    ],
                    "rules": [
                        "Rule #2 (Live Design Document)"
                    ],
                    "status": "not_started",
                    "estimated_hours": 1.5
                },
                {
                    "task_id": "5.2",
                    "description": "Create example integrations documentation",
                    "files": [
                        "KDS/integrations/README.md",
                        "KDS/integrations/dotnet-blazor/README.md",
                        "KDS/integrations/react-typescript/README.md"
                    ],
                    "tests": [
                        "Each integration has clear setup instructions",
                        "Examples are specific to that technology",
                        "Can be followed step-by-step"
                    ],
                    "acceptance_criteria": [
                        "Document: How to use KDS with different project types",
                        "Include: .NET Blazor example (abstract from Noor Canvas)",
                        "Include: React + TypeScript example",
                        "Include: Python + Django example (placeholder)",
                        "Each integration shows: Setup, Configuration, First feature workflow",
                        "Cross-link from main README"
                    ],
                    "rules": [
                        "Rule #2"
                    ],
                    "status": "not_started",
                    "estimated_hours": 1.0
                }
            ]
        },
        {
            "phase_number": 6,
            "name": "Git Workflow Configuration",
            "description": "Make git hooks configurable for different branch strategies",
            "estimated_hours": 1.0,
            "tasks": [
                {
                    "task_id": "6.1",
                    "description": "Make git hooks branch-name configurable",
                    "files": [
                        "KDS/hooks/pre-commit",
                        "KDS/hooks/post-merge",
                        "KDS/docs/GIT-HOOKS.md"
                    ],
                    "tests": [
                        "Hooks work with custom branch name",
                        "Default to 'kds' if not configured",
                        "Configuration can be set via git config"
                    ],
                    "acceptance_criteria": [
                        "Add: KDS_BRANCH=$(git config --get kds.branch || echo 'kds')",
                        "Replace: Hard-coded 'features/kds' with $KDS_BRANCH",
                        "Document: How to configure custom branch",
                        "Example: git config kds.branch 'my-kds-branch'",
                        "Test: Works with 'kds', 'features/kds', 'dev/kds' branch names",
                        "Update hook installation script to explain configuration"
                    ],
                    "rules": [
                        "Rule #5 (KDS Branch Isolation)"
                    ],
                    "status": "not_started",
                    "estimated_hours": 1.0
                }
            ]
        },
        {
            "phase_number": 7,
            "name": "Integration Testing & Validation",
            "description": "Test complete setup on mock project and validate all components",
            "estimated_hours": 2.5,
            "tasks": [
                {
                    "task_id": "7.1",
                    "description": "End-to-end test on mock .NET project",
                    "files": [
                        "KDS/tests/integration/test-dotnet-setup.ps1"
                    ],
                    "tests": [
                        "Setup completes successfully",
                        "Can create and execute a simple plan",
                        "BRAIN learns from the interaction",
                        "Session state persists correctly"
                    ],
                    "acceptance_criteria": [
                        "Copy KDS to mock project folder",
                        "Run: ./setup.ps1 -ProjectName 'MockDotNet' -Framework 'aspnet'",
                        "Verify: All configs generated",
                        "Test: Create plan 'Add user login feature'",
                        "Test: Resume session in new 'chat' (simulate)",
                        "Verify: Zero hard-coded paths in generated files",
                        "Verify: BRAIN contains generic patterns only",
                        "All tests pass"
                    ],
                    "rules": [
                        "Rule #8 (Test-First)",
                        "Rule #16 (Mandatory Post-Task)"
                    ],
                    "status": "not_started",
                    "estimated_hours": 1.0
                },
                {
                    "task_id": "7.2",
                    "description": "End-to-end test on mock React project",
                    "files": [
                        "KDS/tests/integration/test-react-setup.ps1"
                    ],
                    "tests": [
                        "Setup completes successfully on React project",
                        "Project type auto-detection works",
                        "Can create UI component plan"
                    ],
                    "acceptance_criteria": [
                        "Copy KDS to mock React project folder",
                        "Run: ./setup.ps1 (auto-detect mode)",
                        "Verify: Detected type = 'react-typescript'",
                        "Verify: Generated configs use 'npm run build'",
                        "Test: Create plan 'Add dark mode toggle'",
                        "Verify: Playwright config suggestions are correct",
                        "All tests pass"
                    ],
                    "rules": [
                        "Rule #8",
                        "Rule #9 (Tooling Auto-Setup)"
                    ],
                    "status": "not_started",
                    "estimated_hours": 0.5
                },
                {
                    "task_id": "7.3",
                    "description": "Run final audit and generate migration report",
                    "files": [
                        "KDS/docs/INDEPENDENCE-MIGRATION-REPORT.md"
                    ],
                    "tests": [
                        "Audit script reports zero violations",
                        "Independence score is 95+/100",
                        "Report documents all changes"
                    ],
                    "acceptance_criteria": [
                        "Run: ./scripts/audit/audit-dependencies.ps1",
                        "Verify: Zero hard-coded paths",
                        "Verify: Zero Noor Canvas references (except in integrations/)",
                        "Generate: Before/after comparison report",
                        "Document: Files changed, lines modified, tests passed",
                        "Calculate: New independence score (target: 95+)",
                        "List: Remaining optional improvements",
                        "Get approval: Ready for DevProjects migration"
                    ],
                    "rules": [
                        "Rule #2 (Live Design Document)",
                        "Rule #16 Step 5"
                    ],
                    "status": "not_started",
                    "estimated_hours": 1.0
                }
            ]
        }
    ],
    "next_steps": {
        "immediate": "Review this plan and get stakeholder approval",
        "execution": "Execute phases sequentially starting with Phase 0",
        "validation": "Test on mock projects before declaring independence"
    },
    "risks": [
        {
            "risk": "Breaking existing Noor Canvas KDS integration",
            "mitigation": "Preserve Noor Canvas patterns in integrations/ folder",
            "severity": "Medium"
        },
        {
            "risk": "BRAIN learning quality degrades with generic-only patterns",
            "mitigation": "Make integration imports easy, document benefits",
            "severity": "Low"
        },
        {
            "risk": "Setup wizard doesn't handle edge cases",
            "mitigation": "Comprehensive testing on multiple project types",
            "severity": "Medium"
        }
    ],
    "success_metrics": {
        "independence_score": "95+/100 (vs current 65/100)",
        "setup_time": "<5 minutes on new project",
        "hard_coded_paths": "0 occurrences (vs current 42+)",
        "application_specific_brain": "0 entries in default (vs current 20+)",
        "test_coverage": "All critical paths tested on 2+ project types"
    }
}