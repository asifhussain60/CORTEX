# TIER 2: LONG-TERM MEMORY - File Relationships
# Version: 1.0 (migrated from kds-brain/knowledge-graph.yaml)
# Last Updated: 2025-11-03
# Purpose: Learned file relationships and co-modification patterns
# Auto-updated by: brain-updater.md

relationships:
  host_control_panel:
    primary_file: "SPA/NoorCanvas/Pages/HostControlPanel.razor"
    related_files:
      - path: "SPA/NoorCanvas/Services/ShareButtonInjectionService.cs"
        relationship: "service_injection"
        confidence: 1.0
        co_modification_count: 5
      
      - path: "SPA/NoorCanvas/wwwroot/css/noor-canvas.css"
        relationship: "styling"
        confidence: 1.0
        co_modification_count: 8
      
      - path: "SPA/NoorCanvas/Components/Host/HostControlPanelSidebar.razor"
        relationship: "child_component"
        confidence: 1.0
        description: "Sidebar containing Start Session button"
        co_modification_count: 3
      
      - path: "SPA/NoorCanvas/Controllers/HostController.cs"
        relationship: "api_backend"
        confidence: 1.0
        description: "API endpoints for session management"
        co_modification_count: 4
      
      - path: "KDS/docs/flows/start-session-button-flow.md"
        relationship: "flow_documentation"
        confidence: 1.0
        description: "Complete flow map of Start Session button execution"
        co_modification_count: 1
    
    modification_pattern: "co_modification"
    last_modified: "2025-11-03"
  
  start_session_flow:
    primary_file: "SPA/NoorCanvas/Components/Host/HostControlPanelSidebar.razor"
    button_id: "sidebar-start-session-btn"
    execution_chain:
      - step: 1
        description: "Button click event"
        file: "Components/Host/HostControlPanelSidebar.razor"
        line: 82
        element_id: "sidebar-start-session-btn"
      
      - step: 2
        description: "Event handler invoked"
        file: "Pages/HostControlPanel.razor"
        line: 1325
        method: "StartSession()"
      
      - step: 3
        description: "HTTP POST to API"
        endpoint: "/api/host/session/{sessionId}/start"
        method: "POST"
        parameters: ["sessionId", "canvasType"]
      
      - step: 4
        description: "API controller processes request"
        file: "Controllers/HostController.cs"
        line: 386
        method: "StartSession(int sessionId, string canvasType)"
      
      - step: 5
        description: "Database update"
        file: "Controllers/HostController.cs"
        line: 410
        updates: ["StartedAt", "Status", "CanvasType"]
      
      - step: 6
        description: "SignalR broadcast"
        file: "Controllers/HostController.cs"
        line: 429
        event: "SessionBegan"
        target_group: "session_{sessionId}"
      
      - step: 7
        description: "Response handling and UI update"
        file: "Pages/HostControlPanel.razor"
        line: 1343
        updates: ["SessionStatus", "sessionStartTime", "UI re-render"]
      
      - step: 8
        description: "Share button injection (two-phase)"
        phase_1:
          name: "Server-side asset buttons"
          file: "Pages/HostControlPanel.razor"
          line: 3190
          method: "InjectShareButtons()"
          target: "Asset containers"
          technology: "C# Regex"
        phase_2:
          name: "Client-side section buttons"
          file: "wwwroot/js/transcript-section-parser.js"
          line: 45
          method: "injectShareButtons()"
          target: "h2 sections"
          technology: "JavaScript DOM"
    
    documentation: "KDS/docs/flows/start-session-button-flow.md"
    last_mapped: "2025-11-03"
    
    share_button_injection:
      architecture: "two-phase"
      phase_1_server:
        description: "Asset share buttons injected during HTML transform"
        timing: "After session start, during TransformTranscriptHtmlAsync"
        data_source: "SessionAssets API"
        method: "InjectShareButtons(html, assets)"
        marker: "data-asset-id attribute"
      phase_2_client:
        description: "Section share buttons injected after DOM render"
        timing: "After Blazor render, via HandleTranscriptRendered callback"
        data_source: "DOM h2 elements"
        script: "transcript-section-parser.js"
        method: "TranscriptSectionParser.injectShareButtons()"
        canvas_filter: "Only for transcript canvas (skips asset canvas)"
  
  playwright_test_preparation:
    primary_file: "SPA/NoorCanvas/Components/HostControlPanelContent.razor"
    related_files:
      - path: "Docs/PLAYWRIGHT-IDS-FAB-BUTTON.md"
        relationship: "test_documentation"
        confidence: 1.0
        reason: "Component IDs documented for Playwright testing"
    modification_pattern: "component_with_test_documentation"
    frequency: 1
  
  kds_dashboard:
    primary_file: "KDS/kds-dashboard.html"
    related_files:
      - path: "KDS/scripts/run-health-checks.ps1"
        relationship: "health_check_engine"
        confidence: 1.0
        reason: "Executes health checks called by dashboard"
      
      - path: "KDS/scripts/dashboard-api-server.ps1"
        relationship: "api_backend"
        confidence: 1.0
        reason: "HTTP server providing health check API"
      
      - path: "KDS/scripts/launch-dashboard.ps1"
        relationship: "unified_launcher"
        confidence: 1.0
        reason: "All-in-one launcher for server + dashboard"
      
      - path: "KDS/scripts/open-dashboard.ps1"
        relationship: "simple_launcher"
        confidence: 1.0
        reason: "Dashboard-only launcher"
      
      - path: "KDS/dashboard/README.md"
        relationship: "primary_documentation"
        confidence: 1.0
        reason: "Main dashboard documentation"
      
      - path: ".vscode/tasks.json"
        relationship: "vscode_integration"
        confidence: 1.0
        reason: "VS Code tasks for easy launching"
    
    modification_pattern: "dashboard_ecosystem"
    frequency: 1
    created: "2025-11-03"
    feature_type: "health_monitoring"

metadata:
  total_relationships: 4
  last_updated: "2025-11-03T19:00:00Z"
  version: "1.0"
  source: "kds-brain/knowledge-graph.yaml"
  migration_date: "2025-11-04"
  tier: 2
  purpose: "File relationships and co-modification patterns - helps predict which files to edit together"
  auto_managed: true
  housekeeping_service: "consolidation-service"
